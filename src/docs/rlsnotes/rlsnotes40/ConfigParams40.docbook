  <chapter id="rnfb40-fbconf">
    <chapterinfo>
      <title>Configuration Additions and Changes</title>
    </chapterinfo>

    <section id="rnfb40-config-timeouts">
      <title>Parameters for Timeouts</title>
      <para>Two new parameters are available for global and per-database
      configuration, respectively, of server-wide and database-wide idle session and
      statement timeouts.  They are discussed in detail elsewhere (see links).</para>

      <section id="rnfb40-config-timeouts-session">
        <title>ConnectionIdleTimeout</title>
        <para>The value is integer, expressing minutes. Study the notes on
        idle session timeouts carefully to understand how this configuration fits in
        with related settings via SQL and the API.</para>
        <para>See <link linkend="rnfb40-session-timeouts-setting">Setting the Session Timeout</link>
        in the chapter <quote>Changes to the Firebird Engine</quote>.</para>
      </section>

      <section id="rnfb40-config-timeouts-stmnt">
        <title>StatementTimeout</title>
        <para>The value is integer, expressing seconds. Study the notes on
        statement timeouts carefully to understand how this configuration fits in
        with related settings via SQL and the API.</para>
        <para>See <link linkend="rnfb40-stmnt-timeouts-setting">Setting a Statement 
        Timeout</link> in the chapter <quote>Changes to the Firebird Engine</quote>.</para>
      </section>
    </section><!-- rnfb40-config-timeouts -->
    
    <section id="rnfb40-config-connpool">
      <title>Parameters for External Connection Pooling</title>
      <para>These parameters enable customization of aspects of pooling 
      external connections.</para>
      <section id="rnfb40-config-pool-size"><!-- Level 3 -->
        <title>ExtConnPoolSize</title>
        <para>Configures the maximum number of idle connections allowed in
        the pool.  It is an integer, from 0 to 1000.  The installation default
        is 0, which disables the connection pool.</para>
      </section><!-- L3 -->

      <section id="rnfb40-config-pool-lifetime"><!-- Level 3 -->
        <title>ExtConnPoolLifetime</title>
        <para>Configures the number of seconds a connection should stay available 
        after it has gone idle.  The installation default is 7200 seconds.</para>
      </section><!-- L3 -->

    </section>

    <section id="rnfb40-config-max-id-lgth">
      <title>Parameters to Restrict Length of Object Identifiers</title>

      <para>Object identifiers in an ODS 13 database can be up to 63 characters in
      length and the engine stores them in UTF-8, not UNICODE_FSS as previously.
      Two new global or per-database parameters are available if you need to restrict
      either the byte-length or the character-length of object names in ODS 13 databases
      for some reason.</para>
      <para>Longer object names are optional, of course.  Reasons you might need to 
      restrict their length could include:
        <itemizedlist spacing="compact">
          <listitem>Constraints imposed by the client language interface of 
          existing applications, such as <emphasis>gpre</emphasis> or Delphi</listitem>
          <listitem>In-house coding standards</listitem>
          <listitem>Interoperability for cross-database applications such as 
          a third-party replication system or an in-house system that uses
          multiple versions of Firebird</listitem>
        </itemizedlist>
      This is not an exhaustive list.  It is the responsibility of the developer
      to test usage of longer object names and establish whether length restriction
      is necessary.</para>

      <para>Whether setting one or both parameters has exactly the same effect will
      depend on the characters you use.  Any non-ASCII character requires 2 bytes or 
      more in UTF-8, so one cannot assume that byte-length and
      character-length have a direct relationship in all situations.</para>
      <para>The two settings are verified independently and if either constrains
      the length limit imposed by the other, use of the longer identifier will be 
      disallowed.</para>

      <warning>If you set either parameter globally, i.e., in firebird.conf,
      it will affect all databases, including the security database.  That has
      the potential to cause problems!</warning>

      <section id="rnfb40-config-max-id-bytes">
        <title>MaxIdentifierByteLength</title>
        <para>Sets a limit for the number of bytes allowed in an
        object identifier.  It is an integer, defaulting to 252 bytes,
        i.e., 63 characters * 4, 4 being the maximum number of bytes
        for each character.</para>
        <para>To set it to the limit in previous Firebird versions,
        use 31.</para>
      </section>

      <section id="rnfb40-config-max-id-chars">
        <title>MaxIdentifierCharLength</title>
        <para>Sets a limit for the number of characters allowed in an
        object identifier.  It is an integer, defaulting to 63, the
        new limit implemented in Firebird 4.</para>
      </section>
    </section> <!-- rnfb40-config-max-id-lgth -->
    
    <section id="rnfb40-config-read-consistency">
      <title>Parameters Supporting Read Consistency in Transactions</title>
      <para>Firebird 4 takes a <link linkend="rnfb40-engine-commit-order">new approach 
      to read consistency within transaction snapshots</link>, enabling, amongst other benefits, 
      a sustained consistent read for statements within READ COMMITTED transactions.
      This group of parameters allows for some customisation of the elements 
      involved.</para>

      <section id="rnfb40-config-read-tpcblocksize">
        <title>TipCacheBlockSize</title>
        <para>The list of all known transactions with associated Commit Numbers is
        maintained in shared memory. It is implemented as an array whose index is
        a transaction ID and its item value is the corresponding Commit Number. </para>
        <para>The whole array is split into fixed-size blocks containing the CN's
        for all transactions between the OIT and Next Transaction markers.  When
        the <quote>Next Transaction</quote> marker moves out of the scope of the 
        highest block, a new block is allocated.  An old block is released when the 
        <quote>Oldest [Interesting] Transaction</quote> (OIT) marker moves out of
        the scope of the lowest block.</para>

        <para>The default size for a TIP page cache block is 4MB,
        providing capacity for 512 * 1024 transactions.  Use this parameter to 
        configure a custom TIP page cache block size in <filename>firebird.conf</filename>
        and/or <filename>databases.conf</filename>.
        </para>
      </section>

      <section id="rnfb40-config-readconsistency">
        <title>ReadConsistency</title>
        <para>For now, existing applications can be tested with and without 
        the new 
        <link linkend="rnfb40-engine-read-consistency">READ COMMITTED READ 
        CONSISTENCY</link> isolation level by setting this parameter.  Possible 
        values are 1 and 0.
        <variablelist>
          <varlistentry>
            <term>ReadConsistency = 1</term>
            <listitem>(Default) The engine ignores [NO] RECORD VERSION flags
            and makes all read-committed transactions READ COMMITTED READ
            CONSISTENCY.</listitem>
          </varlistentry>

          <varlistentry>
            <term>ReadConsistency = 0</term>
            <listitem>Allows the legacy engine behaviour, with the RECORD VERSION
            and NO RECORD VERSION sub-levels valid to use.  READ COMMITTED READ
            CONSISTENCY is available but needs to be be specified explicitly.</listitem>
         </varlistentry>
        </variablelist>
        </para>
      </section>

      <section id="rnfb40-config-read-consistency-03">
        <title>SnapshotsMemSize</title>
        <para>To handle garbage collection of record versions younger than
        the Oldest Snapshot, (<quote>intermediate record versions</quote>) the
        engine maintains in shared memory an array that it can search for
        the Commit Number (CN) of a particular record version.  See the
        <link linkend="rnfb40-engine-commit-order-gc">Garbage Collection</link> topic
        the chapter <firstterm>Changes in the Firebird Engine</firstterm>.</para>
        <para>The default initial size of this shared memory block is 64KB but it
        will grow automatically when required.  The initial block can be set to a custom
        size in <filename>firebird.conf</filename> and/or
        <filename>databases.conf</filename>.</para>
      </section>

    </section> <!-- rnfb40-config-read-consistency -->

    <section id="rnfb40-config-tempcachelimit">
      <title>TempCacheLimit at Database Level</title>
      <author>
        <firstname>Dmitry</firstname><surname>Yemanov</surname>
      </author>
     <para>See Tracker ticket
     <ulink url="http://tracker.firebirdsql.org/browse/CORE-5718">CORE-5718</ulink></para>
     <para><code>TempCacheLimit</code>, for setting the maximum amount of
     temporary space that can be cached in memory, can now be configured at
     database level, i.e., in <filename>databases.conf</filename>. Previously,
     it was available only as a global setting for all databases.</para>
   </section>

</chapter>