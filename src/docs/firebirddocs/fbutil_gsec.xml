<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"../../../tools/docbook-dtd/docbookx.dtd">
<article id="gsec">
  <title>Firebird Password File Utility</title>

  <titleabbrev>Gsec - Password File Utility</titleabbrev>

  <articleinfo>
    <date>20 October 2009</date>

    <author>
      <firstname>Norman</firstname>

      <surname>Dunbar</surname>
    </author>

    <edition>11 October 2011 – Document version 1.4</edition>
  </articleinfo>

  <section id="gsec-intro">
    <title>Introduction</title>

    <para><application>Gsec</application> is the security database
    manipulation utility. It allows the SYSDBA (or any privileged user) the
    ability to maintain user accounts for various Firebird databases. Using
    various options, users can be added, amended or deleted from the security
    database.</para>

    <note>
      <para>A privileged user is an account on the database server which the
      Firebird engine considers to be privileged enough to automatically be
      given SYSDBA rights. At present there are four login names that are
      assumed to be privileged, these are:</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para>root</para>
        </listitem>

        <listitem>
          <para>firebird</para>
        </listitem>

        <listitem>
          <para>interbase</para>
        </listitem>

        <listitem>
          <para>interbas (without the 'e')</para>
        </listitem>
      </itemizedlist>
    </note>

    <para>Normal users, ie all those accounts not listed above, can only see
    their own user details from version 2.0 of Firebird. They can, however,
    change their own passwords with the new version. Previously the SYSDBA had
    to make the changes on behalf of the users..</para>

    <note>
      <para>It is possible on some operating systems that users will not be
      able to run <application>gsec</application>, even if they know the
      SYSDBA password. This is because those operating systems allow the
      system administrator to set file system permissions which prevent
      execution of certain programs and utilities for security reasons.</para>
    </note>

    <para>The Firebird database holds details of all users in a single
    security database. This is located on the server in a normal Firebird
    database named <filename>security.fdb</filename> for Firebird 1.5 or
    <filename>security2.fdb</filename> for Firebird 2.0 onwards. The default
    locations for this file are :</para>

    <itemizedlist spacing="compact">
      <listitem>
        <para><filename class="directory">C:\Program
        Files\Firebird\Firebird_1_5</filename> for Windows. (Change '1_5' to
        suit your Firebird version.)</para>
      </listitem>

      <listitem>
        <para><filename class="directory">/opt/firebird</filename> for Linux
        and other Unix systems.</para>
      </listitem>
    </itemizedlist>

    <para>The <application>gsec</application> utility manipulates data in the
    table(s) in the security database, and by doing so, allows users to be
    added, amended and deleted from the system.</para>

    <para>Up until Firebird 2.0, it used to be possible to use
    <application>isql</application> to connect directly to the security
    database as the SYSDBA user. This is no longer possible, even if you have
    the SYSDBA username and password and/or are logged in as a privileged
    user.</para>

    <para>Like most of the command line utilities supplied with Firebird,
    <application>gsec</application> can be run in interactive or batch mode
    and has a help screen showing all of the utility's options, we'll be
    seeing that a little later on.</para>

    <para>In the remainder of this manual we shall discuss the
    following:</para>

    <itemizedlist spacing="compact">
      <listitem>
        <para>Command line options for <application>gsec</application>.</para>
      </listitem>

      <listitem>
        <para><application>Gsec</application> commands and their
        parameters.</para>
      </listitem>

      <listitem>
        <para>Running <application>gsec</application> in interactive or batch
        modes, both of which allow you to :</para>

        <itemizedlist spacing="compact">
          <listitem>
            <para>Display user details.</para>
          </listitem>

          <listitem>
            <para>Amend user details.</para>
          </listitem>

          <listitem>
            <para>Add new users.</para>
          </listitem>

          <listitem>
            <para>Delete existing users.</para>
          </listitem>
        </itemizedlist>
      </listitem>

      <listitem>
        <para>Using <application>gsec</application> to administer a remote
        security database.</para>
      </listitem>

      <listitem>
        <para>Some caveats, gotchas and foibles of
        <application>gsec</application>.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section id="gsec-cmdline">
    <title>Command Line Options</title>

    <para>Regardless of the mode that <application>gsec</application> is run
    in, there are a number of options that can be supplied on the command
    line. These are :</para>

    <itemizedlist spacing="normal">
      <listitem>
        <para><userinput>-user &lt;username&gt;</userinput></para>

        <para>Allows the username of the SYSDBA user to be specified if the
        database is to be modified, or a normal username if the database is to
        be displayed only. This need not be supplied if
        <envar>ISC_USER</envar> and <envar>ISC_PASSWORD</envar> environment
        variables exist and have the correct values.</para>
      </listitem>

      <listitem>
        <para><userinput>-password &lt;password&gt;</userinput></para>

        <para>Supplies the password for the username specified above. This
        need not be supplied if <envar>ISC_USER</envar> and
        <envar>ISC_PASSWORD</envar> environment variables exist and have the
        correct values.</para>
      </listitem>

      <listitem>
        <para><userinput>-fe[tch_password] &lt;password file name&gt; | stdin
        | /dev/tty</userinput></para>

        <para>This switch causes the password for the appropriate user to be
        read from a file as opposed to being specified on the command line.
        The file name supplied is <emphasis>not</emphasis> in quotes and must
        be readable by the user running <application>gsec</application>. If
        the file name is specified as <filename>stdin</filename>, then the
        user will be prompted for a password. On POSIX systems, the file name
        <filename class="devicefile">/dev/tty</filename> will also result in a
        prompt for the password.</para>

        <note>
          <para>Firebird 2.5 onwards.</para>
        </note>
      </listitem>

      <listitem>
        <para><userinput>-role &lt;SQL role name&gt;</userinput></para>

        <para>Allows the specification of the role to be used by the
        connecting user.</para>
      </listitem>

      <listitem>
        <para><userinput>-database &lt;server:security database
        name&gt;</userinput></para>

        <para>You can specify the full pathname of a security database to
        <application>gsec</application> and this will allow you to remotely
        administer the users for that server. The whole parameter should be
        enclosed in quotes if there are any spaces in the path to the security
        database.</para>
      </listitem>

      <listitem>
        <para><userinput>-z</userinput></para>

        <para>Displays the version number of the
        <application>gsec</application> utility.</para>
      </listitem>

      <listitem>
        <para><userinput>-help</userinput> or <userinput>-?</userinput></para>

        <para>Help displays the following screen of information :</para>
      </listitem>
    </itemizedlist>

    <screen>   gsec utility - maintains user password database

   command line usage:
     gsec [ &lt;options&gt; ... ] &lt;command&gt; [ &lt;parameter&gt; ... ]

   interactive usage:
     gsec [ &lt;options&gt; ... ]
     GSEC&gt; 
     &lt;command&gt; [ &lt;parameter&gt; ... ]

   available options:
     -user &lt;database administrator name&gt;
     -password &lt;database administrator password&gt;
     -fetch_password &lt;file to fetch password from&gt;
     -role &lt;database administrator SQL role name&gt;
     -trusted (use trusted authentication)
     -database &lt;database to manage&gt;
     -z

   available commands:
     adding a new user:
       add &lt;name&gt; [ &lt;parameter&gt; ... ]
     deleting a current user:
       delete &lt;name&gt;
     displaying all users:
       display
     displaying one user:
       display &lt;name&gt;
     modifying a user's parameters:
       modify &lt;name&gt; &lt;parameter&gt; [ &lt;parameter&gt; ... ]
     changing admins mapping to RDB$ADMIN role in security database:
       mapping {set|drop}
     help:
       ? (interactive only)
       help
     displaying version number:
       z (interactive only)
     quit interactive session:
       quit (interactive only)

   available parameters:
     -pw &lt;password&gt;
     -uid &lt;uid&gt;
     -gid &lt;uid&gt;
     -fname &lt;firstname&gt;
     -mname &lt;middlename&gt;
     -lname &lt;lastname&gt;
     -admin {yes|no}

     </screen>
  </section>

  <section id="gsec-commands">
    <title>Gsec Commands</title>

    <para>After the assorted options, comes the command that you wish to run.
    The following commands are available in both batch and interactive modes,
    but for interactive mode the leading minus sign is not required.</para>

    <itemizedlist spacing="normal">
      <listitem>
        <para><userinput>-add &lt;name&gt; [ &lt;parameter&gt; ...
        ]</userinput></para>

        <para>This command adds a new user to the database. You may optionally
        add other details such as first, middle and last names plus a password
        for the new user, all in the same <userinput>add</userinput> command.
        Alternatively, you may add a user then <userinput>modify</userinput>
        it to fill in the missing details.</para>
      </listitem>

      <listitem>
        <para><userinput>-delete &lt;name&gt;</userinput></para>

        <para>This command removes the named user from the database. All
        details of the user are removed and cannot be undone unless you add
        the user back again.</para>
      </listitem>

      <listitem>
        <para><userinput>-display [ &lt;name&gt; ]</userinput></para>

        <para>This command displays the details of a single named user, or all
        users in the database. The password is never displayed.</para>
      </listitem>

      <listitem>
        <para><userinput>-modify &lt;name&gt; &lt;parameter&gt; [
        &lt;parameter&gt; ... ]</userinput></para>
      </listitem>
    </itemizedlist>

    <para>The &lt;name&gt; option is how you wish the user to be known when
    connecting to Firebird databases. Some of the above commands take
    parameters and these are one, or more, of the following :</para>

    <itemizedlist spacing="normal">
      <listitem>
        <para><userinput>-pw &lt;password&gt;</userinput></para>

        <para>This parameter lets you supply a new password for the user. If
        you omit the password, the current one will be removed and the user
        will be unable to login to any Firebird databases at all. The password
        can be up to 8 characters long, but when supplying one to
        <application>gsec</application>, or logging into databases, the
        characters after the eighth are simply ignored.</para>
      </listitem>

      <listitem>
        <para><userinput>-uid &lt;uid&gt;</userinput></para>
      </listitem>

      <listitem>
        <para><userinput>-gid &lt;gid&gt;</userinput></para>

        <para><userinput>-uid</userinput> and <userinput>-gid</userinput> are
        used on some POSIX systems to enter the Unix userid and groupid as
        found in <filename>/etc/passwd</filename> and
        <filename>/etc/group</filename> configuration files. If not supplied,
        these default to zero.</para>
      </listitem>

      <listitem>
        <para><userinput>-fname [ &lt;first name&gt; ]</userinput></para>

        <para>This parameter allows you to store the user's first name in the
        database. This helps when identifying users from their login name -
        which may be abbreviated. You can delete a first name by not supplying
        a name.</para>
      </listitem>

      <listitem>
        <para><userinput>-mname [ &lt;middle name&gt; ]</userinput></para>

        <para>This parameter allows you to store the user's middle name in the
        database. This helps when identifying users from their login name -
        which may be abbreviated. You can delete a middle name by not
        supplying a name.</para>
      </listitem>

      <listitem>
        <para><userinput>-lname [ &lt;lastname&gt; ]</userinput></para>

        <para>This parameter allows you to store the user's last name in the
        database. This helps when identifying users from their login name -
        which may be abbreviated. You can delete a last name by not supplying
        a name.</para>
      </listitem>

      <listitem>
        <para><userinput>-admin yes | no</userinput></para>

        <para>This parameter allows you to specify whether or not the user
        will be granted the RDB$ADMIN role.</para>

        <note>
          <para>Firebird 2.5 onwards.</para>
        </note>
      </listitem>
    </itemizedlist>
  </section>

  <section id="gsec-interactive">
    <title>Interactive Mode</title>

    <para>To run <application>gsec</application> in interactive mode, start
    the utility using the command line :</para>

    <screen>C:\&gt;gsec -user sysdba -password masterkey
GSEC&gt;</screen>

    <para>The GSEC&gt; prompt shows that the utility is waiting for a command.
    The <userinput>-user</userinput> and <userinput>-password</userinput>
    options are those of the user who wishes to manipulate the security
    database. Obviously, the username supplied must be a valid SYSDBA user if
    updates are to be carried out. Normal users may only read the
    database.</para>

    <note>
      <para>With Firebird 1.5 and Windows Vista this may not work correctly
      and an 'unavailable database' error will be displayed. The problem is
      caused by trying to use the IPCServer transport implemented in Firebird
      1.5 which doesn't work on Vista. The solution is to use TCP local
      loopback.</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para>Put an alias in <filename>aliases.conf</filename> for the path
          to your <filename>security.fdb</filename>, e.g. sec =
          <filename>C:\Program
          Files\Firebird\Firebird_1_5\security.fdb</filename>.</para>
        </listitem>

        <listitem>
          <para>Call <application>gsec</application> using <command>gsec
          -database localhost:sec -user SYSDBA -password masterkey
          </command></para>
        </listitem>
      </itemizedlist>

      <para>As localhost may not be available on some Vista workstations you
      may have to change localhost in the command above to use the actual host
      name or the IP address of the Vista computer.</para>
    </note>

    <para>To exit <application><application>gsec</application></application>
    in interactive mode, the <userinput>quit</userinput> command is used
    :</para>

    <screen>GSEC&gt; quit
C:\&gt;</screen>

    <para>The following sections show how to carry out various commands in
    interactive mode. It is assumed that you are already running the utility
    as a SYSDBA user.</para>

    <section id="gsec-display">
      <title>Displaying User Details</title>

      <note>
        <para>From Firebird 2.5 onwards, the display command shows an
        additional column named admin. This shows the text admin where a user
        has been granted the RDB$ADMIN role either within the database, or by
        using <application>gsec</application>. In the following examples,
        where it is necessary to show this detail, it will be shown,
        otherwise, all output examples are as per Firebird 2.0.</para>
      </note>

      <para>To display all users in the security database the command, and
      it's output are :</para>

      <screen>GSEC&gt; display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia
GSEC&gt; </screen>

      <para>To display details of a single user, pass the username as a
      parameter to the <userinput>display</userinput> command.</para>

      <screen>GSEC&gt; display epocman
     user name                      uid   gid     full name
------------------------------------------------------------------------
EPOCMAN                             0     0      Benoit Gilles Mascia
GSEC&gt; </screen>

      <para>If you enter the name of a non-existent user as a parameter of the
      <userinput>display</userinput> command, nothing is displayed and gsec
      remains in interactive mode.</para>

      <screen>GSEC&gt; display alison
GSEC&gt; </screen>
    </section>

    <section id="gsec-adding">
      <title>Adding New Users</title>

      <para>When adding a new user in interactive mode, nothing is displayed
      to confirm that the user was indeed added. You need to use the
      <userinput>display</userinput> or <userinput>display
      &lt;name&gt;</userinput> commands to make sure that the user was added
      successfully.</para>

      <screen>GSEC&gt; add newuser -pw newuser -fname New -lname User
GSEC&gt; </screen>

      <screen>GSEC&gt; display newuser
     user name                      uid   gid     full name
------------------------------------------------------------------------
NEWUSER                             0     0      New  User
GSEC&gt; </screen>

      <para>From Firebird 2.5 onwards, a new role - RDB$ADMIN - has been added
      to the security database. <application>Gsec</application> allows you to
      indicate whether new users are assigned this role. The display command
      has also been modified to show whether a user had this role or not.
      </para>

      <screen>GSEC&gt; add newadmin -pw secret -fname New -mname admin -lname User -admin yes
GSEC&gt; </screen>

      <screen>GSEC&gt; display newadmin
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NEWADMIN                            0     0 admin     New admin User
GSEC&gt; </screen>
    </section>

    <section id="gsec-deleting">
      <title>Deleting Existing Users</title>

      <para>When deleting a user in interactive mode, there is no confirmation
      that the user has been deleted. You should use the
      <userinput>display</userinput> or <userinput>display
      &lt;name&gt;</userinput> command to check.</para>

      <screen>GSEC&gt; delete newuser
GSEC&gt; </screen>

      <screen>GSEC&gt; display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia
GSEC&gt; </screen>

      <para>If, on the other hand, you try to delete a non-existing user,
      <application>gsec</application> will display an error message, and
      exit.</para>

      <screen>GSEC&gt; delete newuser
record not found for user: NEWUSER

C:\&gt;</screen>
    </section>

    <section id="gsec-amending">
      <title>Amending Existing Users</title>

      <para>Existing users can have one or more of their password, first name,
      middle name or lastname amended. There is no confirmation that your
      modification has worked, so you must use one of the
      <userinput>display</userinput> commands to determine how well it
      worked.</para>

      <screen>GSEC&gt; modify norman -pw newpassword
GSEC&gt; </screen>

      <screen>GSEC&gt; modify norman -mname MiddleName -fname Fred
GSEC&gt; </screen>

      <screen>GSEC&gt; display norman
     user name                      uid   gid     full name
------------------------------------------------------------------------
NORMAN                              0     0      Fred MiddleName Dunbar
GSEC&gt; </screen>

      <para>If you wish to remove one or more of a user's attributes, don't
      pass a (new) value for that attribute.</para>

      <screen>GSEC&gt; modify norman -mname -fname -lname</screen>

      <screen>GSEC&gt; display norman
     user name                      uid   gid     full name
------------------------------------------------------------------------
NORMAN                              0     0      
GSEC&gt;</screen>

      <para>Now I can be known as 'the man with no name', just like Clint
      Eastwood !</para>

      <para>From Firebird 2.5 onwards, a user's admin rights can be modified
      using this command:</para>

      <screen>GSEC&gt; modify norman -admin yes</screen>

      <screen>GSEC&gt; display norman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0 admin     New admin User
GSEC&gt; </screen>
    </section>

    <section>
      <title>OS Admin Mapping</title>

      <note>
        <para>Firebird 2.5.</para>
      </note>

      <para>Since Firebird 2.1, Windows domain administrators have had
      <emphasis>full</emphasis> access to the user management functions. This
      meant that when an admin user connected to the server and then used
      <application>gsec</application>, they had the ability to modify
      <emphasis>any</emphasis> user account in the security database.</para>

      <para>From Firebird 2.5 they do <emphasis>not</emphasis> get these
      privileges automatically unless the DBA has configured the security
      database to make it happen automatically. This is done either in
      <application>isql</application> as follows:</para>

      <screen>SQL&gt; SQL&gt; alter role rdb$admin set auto admin mapping;
SQL&gt; commit;
</screen>

      <para>The command above will cause all Windows Administrator accounts to
      automatically have full access to the user management functions. The
      automatic mapping can be revoked as follows:</para>

      <screen>SQL&gt; SQL&gt; alter role rdb$admin drop auto admin mapping;
SQL&gt; commit;
</screen>

      <para>The functionality of the above <application>isql</application>
      commands can also be set using <application>gsec</application>, as
      follows, by using the <userinput>-mapping</userinput> command. The
      command takes a parameter of <userinput>set</userinput> or
      <userinput>drop</userinput> accordingly.</para>

      <screen>GSEC&gt; mapping set</screen>

      <para>or:</para>

      <screen>GSEC&gt; mapping drop</screen>
    </section>

    <section>
      <title>Help</title>

      <para>The <userinput>help</userinput> command, in interactive mode,
      displays the same help screen as shown above. From Firebird 2.5, this
      can be abbreviated to a single question mark.</para>
    </section>

    <section id="gsec-version">
      <title>Version Information</title>

      <para>The version of <application>gsec</application> can be obtained
      using the <userinput>z</userinput> command.</para>

      <screen>GSEC&gt; z
gsec version  WI-V1.5.0.4306 Firebird 1.5
GSEC&gt;</screen>

      <para>Or, in <application>gsec</application> from Firebird 2.5:</para>

      <screen>GSEC&gt; z
gsec version LI-V2.5.0.26074 Firebird 2.5
GSEC&gt;
</screen>
    </section>
  </section>

  <section id="gsec-batch">
    <title>Batch Mode</title>

    <note>
      <para>In the following descriptions of batch mode operations, assume
      that I have set the <envar>ISC_USER</envar> and
      <envar>ISC_PASSWORD</envar> environment variables. This allows
      <application>gsec</application> to be run without always having to
      specify the <userinput>-user</userinput> and
      <userinput>-password</userinput> switches. This in turn reduces the
      amount of code on the command line, which means that when this XML file
      is rendered into pdf, all the command line will fit on the width of an
      A4 page.</para>

      <para>It is not secure to have these variables set all the time, so
      don't do it !</para>
    </note>

    <warning>
      <para>If you are using <application>gsec</application> from Firebird
      version 1.5 (and possibly version 1.0 as well) then when you are running
      in batch mode, you may think that you can check the result of an
      operation by checking <envar>%ERRORLEVEL%</envar> in Windows, or
      <envar>$?</envar> in various flavours of Unix. This doesn't work. The
      result is always zero.</para>

      <para>In <application>gsec</application> from Firebird version 2.0
      onwards, this problem is fixed and the exit code will be zero for
      everything was ok, or a non-zero value for error conditions.</para>
    </warning>

    <para>In batch mode, the command line to run
    <application>gsec</application> is as follows :</para>

    <screen>     gsec [ &lt;options&gt; ... ] &lt;command&gt; [ &lt;parameter&gt; ... ]</screen>

    <section id="gsec-batch-displaying">
      <title>Displaying User Details</title>

      <para>To display all users in the security database the command, and its
      output are :</para>

      <screen>C:\&gt;gsec -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>

      <para>To display details of a single user, pass the username as a
      parameter to the <userinput>display</userinput> command.</para>

      <screen>C:\&gt;gsec -display epocman
     user name                      uid   gid     full name
------------------------------------------------------------------------
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>
    </section>

    <section id="gsec-batch-adding">
      <title>Adding New Users</title>

      <para>When adding a user in batch mode, there is no confirmation that
      the user has been added. You should use the
      <userinput>-display</userinput> or <userinput>-display
      &lt;name&gt;</userinput> command to check.</para>

      <screen>C:\&gt;gsec -add newuser -pw newuser -fname New -lname User
</screen>

      <screen>C:\&gt;gsec -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
NEWUSER                             0     0      New  User
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>

      <para>Under Firebird 2.5, the <userinput>-admin</userinput> parameter
      may be specified:</para>

      <screen>C:\&gt;gsec -add newadmin -pw ignoreit -fname New -mname Admin -lname User -admin yes
</screen>

      <screen>c:\&gt;gsec -display newadmin
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NEWADMIN                            0     0           New Admin User </screen>
    </section>

    <section id="gsec-batch-deleting">
      <title>Deleting Existing Users</title>

      <para>When deleting a user in batch mode, there is no confirmation that
      the user has been deleted. You should use the
      <userinput>-display</userinput> or <userinput>-display
      &lt;name&gt;</userinput> command to check.</para>

      <screen>C:\&gt;gsec -delete newuser</screen>

      <screen>C:\&gt;gsec -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>
    </section>

    <section id="gsec-batch-amending">
      <title>Amending Existing Users</title>

      <para>Existing users can have one or more of their password, first name,
      middle name, lastname or admin rights amended.</para>

      <screen>C:\&gt;gsec -modify norman -pw newpassword</screen>

      <screen>C:\&gt;gsec -modify norman -mname MiddleName -fname Fred
</screen>

      <screen>C:\&gt;gsec -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Fred MiddleName Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>

      <para>If you wish to remove one or more of a user's attributes, don't
      pass a (new) value for that attribute.</para>

      <screen>C:\&gt;gsec -modify norman -mname -fname -lname</screen>

      <screen>C:\&gt;gsec -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>

      <para>Now nobody knows who I am :o)</para>
    </section>

    <section id="gsec-batch-version">
      <title>Version Information</title>

      <para>The version of gsec can be obtained using the
      <userinput>-z</userinput> command. However, note that it leaves you in
      interactive mode on completion. It doesn't exit like the other batch
      mode commands do, so you have to use the interactive
      <userinput>quit</userinput> command to exit. There is a way around this
      problem as shown in the following. The first part shows the problem -
      which still exists in Firebird 2.5.</para>

      <screen>C:\&gt;gsec -z
gsec version  WI-V1.5.0.4306 Firebird 1.5
GSEC&gt; </screen>

      <para>The solution is to have a small file containing the command
      <userinput>quit</userinput> and force gsec to read this file when it
      needs user input, as follows.</para>

      <screen>C:\&gt;copy con fred
quit
^Z
        1 file(s) copied.</screen>

      <screen>C:\&gt;gsec -z &lt;fred
gsec version  WI-V1.5.0.4306 Firebird 1.5
GSEC&gt;
C:\&gt;</screen>

      <para>This could be a good idea for any of the commands which leave you
      'stuck' in the interactive mode when you thought you were running in
      batch mode. By redirecting input from a command file, gsec will read a
      line of text from that file any time it requires user input. By forcing
      it to read the <userinput>quit</userinput> command, you make it
      exit.</para>

      <note>
        <para>The <userinput>-z</userinput> command doesn't need a
        <userinput>-user</userinput> and <userinput>-password</userinput>, it
        will display the version details and then tell you that you don't have
        a username/password - but you can safely ignore this message.</para>
      </note>
    </section>

    <section>
      <title>OS Admin Mapping</title>

      <note>
        <para>Firebird 2.5.</para>
      </note>

      <para>Since Firebird 2.1, Windows domain administrators have had
      <emphasis>full</emphasis> access to the user management functions. This
      meant that when an admin user connected to the server and then used
      gsec, they had the ability to modify any user account in the security
      database.</para>

      <para>The functionality that allows Windows domain administrators to
      have <emphasis>full</emphasis> access to the user management functions
      of the Firebird's security database, can also be set using
      <application>gsec</application> on the command line as follows, by using
      the <userinput>-mapping</userinput> command. The command takes a
      parameter of <userinput>set</userinput> or <userinput>drop</userinput>
      accordingly.</para>

      <screen>C:/&gt; gsec -mapping set</screen>

      <para>or:</para>

      <screen>C:/&gt; gsec -mapping drop</screen>
    </section>
  </section>

  <section id="gsec-remote">
    <title>Running Gsec Remotely</title>

    <para><application>Gsec</application> can be used to administer the
    security database on a remote server. To do this you must supply the
    remote security database name on the command line as shown in the
    following example which connects my Windows XP client version of
    <application>gsec</application> to my Linux server named ganymede and
    allows me to manage the users on my Linux server.</para>

    <screen>C:\&gt;gsec -database ganymede:/opt/firebird/security2.fdb 
         -user sysdba -password masterkey
GSEC&gt;</screen>

    <note>
      <para>In the above example, I have split the full command line over two
      lines. This is to prevent it 'falling off' the right side of the page
      when this manual is rendered as a PDF document. The whole command
      should, indeed must, be typed on a single line.</para>

      <para>Also note that if there are spaces in the database path, you must
      enclose the whole parameter in double quotes.</para>
    </note>

    <para>Once connected to the remote security database, you can manipulate
    users in the normal manner in either interactive or batch modes as
    described above.</para>

    <para>The version of <application>gsec</application> provided in Firebird
    2.0 can be used to maintain the security database on previous versions of
    Firebird and it is hoped, Interbase from version 6.0 upwards. However,
    from version 2.0 of Firebird, the format of the security database changed
    and because of this, gsec from an older version cannot be used to maintain
    the security database for Firebird 2.0 onwards.</para>
  </section>

  <section id="gsec-caveats">
    <title>Gsec caveats</title>

    <para>The following is a brief list of gotchas and funnies that I have
    detected in my own use of <application>gsec</application>. Some of these
    are mentioned above, others may not be. By collecting them all here in one
    place, you should be able to find out what's happening if you have
    problems.</para>

    <section>
      <title>Normal Versus Privileged Users</title>

      <para>Only a privileged user can update the security database. Normal
      users can run the <application>gsec</application> utility, but can only
      list the contents under Firebird 1.5. The following shows what happens
      when trying to update the database when running
      <application>gsec</application> as a normal user.</para>

      <screen>C:\&gt;gsec -user norman -password norman
GSEC&gt; add myuser -pw mypassword
add record error
no permission for insert/write access to TABLE USERS</screen>

      <para>A normal users can only display details from the security
      database.</para>

      <screen>C:\&gt;gsec -user norman -password norman -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>

      <note>
        <para>From Firebird version 2 onwards, there are slight changes to the
        above. Normal users are now able to change their own passwords and can
        no longer display details of other users that may be present in the
        security database.</para>
      </note>

      <para>The above user, running under Firebird 2.0 would see the following
      :</para>

      <screen>C:\&gt;gsec -user norman -password norman -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
NORMAN                              0     0      Norman  Dunbar</screen>
    </section>

    <section>
      <title>Differences Between Batch And Interactive Mode</title>

      <para>The <application>gsec</application> commands apply to both modes
      of operation, however, when running in batch mode, you must prefix the
      command name with a minus sign (-) or you will get an error message
      similar to the following :</para>

      <screen>C:\&gt;gsec -user sysdba -password masterkey display
invalid parameter, no switch defined
error in switch specifications
GSEC&gt;</screen>

      <para>Note also that you will be left in interactive mode when an error
      occurs. The correct command line should have a minus in front of the
      <userinput>display</userinput> command, as follows :</para>

      <screen>C:\&gt;gsec -user sysdba -password masterkey -display
     user name                      uid   gid     full name
------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0      Norman  Dunbar
EPOCMAN                             0     0      Benoit Gilles Mascia</screen>

      <para>This time, <application>gsec</application> performed its duties,
      displayed all known users and quit from the utility.</para>

      <warning>
        <para>If environment variables <envar>ISC_USER</envar> and
        <envar>ISC_PASSWORD</envar> have been defined, and this isn't a very
        good idea for security reasons, <application>gsec</application> can be
        run without passing the <userinput>-user</userinput> or
        <userinput>-password</userinput> options.</para>
      </warning>

      <warning>
        <para>As with all of the command line utilities, it is best to use the
        version of the <application>gsec</application> utility that was
        supplied with your database.</para>
      </warning>
    </section>

    <section>
      <title>Batch Mode Exit Codes</title>

      <para>When running <application>gsec</application> under windows, you
      can trap the exit code in <envar>%ERRORLEVEL%</envar> and check it to
      determine the success or failure of the last command executed.</para>

      <para>When your operating system is Unix - whatever flavour - the exit
      code is to be found in the <envar>$?</envar> variable.</para>

      <para>Unfortunately, using the version of
      <application>gsec</application> supplied with Firebird 1.5, it appears
      that <application>gsec</application> always exits with a zero and this
      makes it quite unsuitable to build into a properly error trapped batch
      script on either system. Sad but true.</para>

      <note>
        <para>From version 2.0 of Firebird, this has been corrected and an
        exit code of zero indicates success while non-zero values indicate
        failures.</para>
      </note>
    </section>

    <section>
      <title>Errors In Batch Mode Swap To Interactive Mode</title>

      <para>Sometimes, when running in batch mode, an error condition in gsec
      will result in gsec switching over to interactive mode. This is not very
      useful if you started gsec in batch mode from a script, because your
      script will just sit there waiting on something to be typed.</para>
    </section>

    <section>
      <title>Potential Security Problems</title>

      <para>Up until Firebird 2.0, running <emphasis>any</emphasis> of the
      Firebird utilities with a password supplied on the command line meant
      that anyone logged on to the same server could call <command>ps
      -efx|grep -i pass</command> (or similar) and be able to see the SYSDBA
      or other passwords. From Firebird 2.0 this is no longer possible as
      Firebird now replaces the supplied password with spaces.</para>
    </section>
  </section>

  <appendix id="gsec-dochist">
    <title>Document history</title>

    <para>The exact file history is recorded in the <filename
    class="directory">manual</filename> module in our CVS tree; see <ulink
    url="http://sourceforge.net/cvs/?group_id=9028">http://sourceforge.net/cvs/?group_id=9028</ulink>.
    The full URL of the CVS log for this file can be found at <ulink
    url="http://firebird.cvs.sourceforge.net/viewvc/firebird/manual/src/docs/firebirddocs/fbutil_gsec.xml?view=log"
    userlevel="">http://firebird.cvs.sourceforge.net/viewvc/firebird/manual/src/docs/firebirddocs/fbutil_gsec.xml?view=log</ulink></para>

    <para><revhistory>
        <revision>
          <revnumber>1.0</revnumber>

          <date>9 November 2004</date>

          <authorinitials>ND</authorinitials>

          <revdescription>
            <para>Created as a chapter in the Command Line Utilities
            manual.</para>
          </revdescription>
        </revision>

        <revision>
          <revnumber>1.1</revnumber>

          <date>19 November 2004</date>

          <authorinitials>ND</authorinitials>

          <revdescription>
            <para>Updated for Firebird 2.0.</para>
          </revdescription>
        </revision>

        <revision>
          <revnumber>1.2</revnumber>

          <date>20 October 2009</date>

          <authorinitials>ND</authorinitials>

          <revdescription>
            <para>More minor updates and converted to a stand alone
            manual.</para>
          </revdescription>
        </revision>

        <revision>
          <revnumber>1.3</revnumber>

          <date>05 January 2010</date>

          <authorinitials>ND</authorinitials>

          <revdescription>
            <para>Updated with details of Firebird 1.5 and Windows Vista not
            working when using IPCServer protocol. Thanks to Helen Borrie for
            the fix information.</para>
          </revdescription>
        </revision>

        <revision>
          <revnumber>1.4</revnumber>

          <date>11 October 2011</date>

          <authorinitials>ND</authorinitials>

          <revdescription>
            <para>Updated for Firebird 2.5.</para>

            <para>Spelling errors corrected.</para>
          </revdescription>
        </revision>
      </revhistory></para>
  </appendix>

  <appendix id="gsec-license">
    <title>License notice</title>

    <para>The contents of this Documentation are subject to the Public
    Documentation License Version 1.0 (the <quote>License</quote>); you may
    only use this Documentation if you comply with the terms of this License.
    Copies of the License are available at <ulink
    url="http://www.firebirdsql.org/pdfmanual/pdl.pdf">http://www.firebirdsql.org/pdfmanual/pdl.pdf</ulink>
    (PDF) and <ulink
    url="http://www.firebirdsql.org/manual/pdl.html">http://www.firebirdsql.org/manual/pdl.html</ulink>
    (HTML).</para>

    <para>The Original Documentation is titled <citetitle>Firebird Password
    File Utility</citetitle>.</para>

    <para>The Initial Writer of the Original Documentation is: Norman
    Dunbar.</para>

    <para>Copyright (C) 2004–2009. All Rights Reserved. Initial Writer
    contact: NormanDunbar at users dot sourceforge dot net.</para>
  </appendix>
</article>
