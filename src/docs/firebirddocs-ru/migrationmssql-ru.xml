<?xml version="1.0" encoding="UTF-8"?>
<!-- For standalone validation, uncomment the following DOCTYPE declaration. -->
<!-- DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"> "file:../docs/docbookx/docbookx.dtd" -->
<article id="migration-mssql-ru" lang="ru">
  <articleinfo>
    <title>Переход с СУБД MS-SQL на СУБД
    <application>Firebird</application></title>
    <titleabbrev>Переход с MS SQL на Firebird</titleabbrev>

    <author>
      <firstname>Marcelo</firstname>
      <surname>Lopez Ruiz</surname>
    </author>

    <othercredit class="translator">
      <firstname>Павел</firstname>
      <surname>Меньщиков</surname>
      <contrib>Перевод на русский язык</contrib>
    </othercredit>

    <edition>1 декабря 2005 - Версия документа 1.1.ru</edition>
  </articleinfo>

  <para><application>Microsoft SQL Server</application> (MS SQL) является широко
  распространенным сервером баз данных. В настоящее время большинство
  пользователей используют три версии этого программного продукта: MS SQL 6.5,
  MS SQL 7 и MS SQL 2000.</para>

  <sect1 id="migration-mssql-intro-ru">
    <title>Введение</title>

    <para>Этот раздел содержит информацию о данном руководстве по переходу
    на использование СУБД <application>Firebird</application>.</para>

    <para>Документация по переходу с СУБД MS SQL Server, прежде всего,
    предназначена для помощи пользователям СУБД оценить, следует ли вообще
    осуществлять такой переход. Также документация знакомит с деталями
    процесса перехода, которые были наработаны различными пользователями
    при переходе на СУБД <application>Firebird</application> с СУБД
    MS SQL Server.</para>

    <para>Есть две вещи, на которые следует обратить внимание при
    переходе.</para>

    <para>Во-первых, проблемность переноса данных из одной СУБД в другую зависит
    от сложности схемы базы данных. Существует много утилит для помощи в этом
    процессе. В данном руководстве показаны стандартные преобразования.</para>

    <para>Во-вторых, возможно, Вам понадобиться перенести хранимые процедуры и
    триггеры <quote>вручную</quote>. Этот процесс может оказаться непростым:
    существует множество различий, больших и не очень, между СУБД. Данное
    руководство дает примеры наиболее часто встречающихся проблем и их
    решений.</para>

    <warning>
      <para>Это руководство было написано в 2003 году, когда текущей версией
      <application>Firebird</application> была версия 1.0. Хотя руководство с тех
      пор немного корректировалось, оно нуждается в полной ревизии. Этот факт не
      должен останавливать Вас от использования данного руководства - просто имейте
      в виду, что содержание может не соответствовать текущей версии
      <application>Firebird</application>, и в случае проблем обращайтесь к
      <literal>Release Notes</literal> (примечания к выпущенной
      версии программы) СУБД <application>Firebird</application> с версии 1.0 до
      используемой Вами версии.</para>
    </warning>
  </sect1>

  <sect1 id="migration-mssql-pros-cons-ru">
    <title><quote>За</quote> и <quote>против</quote></title>

    <para>Этот раздел описывает причины, по которым может понадобиться
    перенос существующей базы данных на СУБД
    <application>Firebird</application>, и причины, по которым этого
    не стоит делать.</para>

    <sect2 id="migration-mssql-pros-ru">
      <title>Зачем переходить на СУБД <application>Firebird</application></title>
      <titleabbrev>Зачем переходить</titleabbrev>

      <para>Причины необходимости перехода могут зависеть от того, какую
      версию MS SQL и с какой целью Вы используете.</para>

      <para>Например, обычно при использовании MS SQL 6.5 причинами для
      перехода могут служить имеющиеся в <application>Firebird</application>
      функции и простота использования. MS SQL 6.5 работает с фиксированными
      устройствами (devices), а не с динамически расширяющимися файлами, что
      ведет к возможным проблемам при администрировании. Также в MS SQL 6.5
      существуют некоторые ошибки и некорректное поведение.</para>

      <para>Если Вы используете MS SQL 7, то Вы знаете, что многие
      <quote>особенности</quote> были исправлены, но многих функций все еще не
      существует (обновляемые представления, бОльшее управление полями
      идентификаторов, функции пользователя, хранимые процедуры, возвращающие
      наборы данных). Вы также не можете использовать каскадную ссылочную
      целостность данных до версии 2000. То же относится к разным порядкам
      сортировки строк в одной базе данных.</para>

      <para>Для операционных систем семейства UNIX
      <application>Firebird</application> способен использовать систему
      безопасности операционной системы. Однако эту функцию желательно
      не использовать для возможности портирования.</para>

      <para>СУБД MS SQL 2000 улучшена по сравнению с MS SQL 7, но, по-прежнему,
      в ней нет такой ключевой функции <application>Firebird</application>,
      как многоверсионная архитектура (multi-generational architecture, MGA),
      которая позволяет иметь <quote>долгие</quote> (по времени существования)
      транзакции, не затрагивающие поведение <quote>быстрых</quote> (по времени
      существования) операционных транзакций. Наоборот, MS SQL убеждает
      пользователей приобрести еще один сервер (оборудование, операционную
      сиситему, сервер баз данных) и установить его только как хранилище данных
      для генерации отчетов. Можно только удивляться необходимости отдельного
      хранилища данных в интегрированной среде, дающей возможности создания
      запросов к разным базам данных (cross-database query).</para>

      <para>Другая причина перехода - исключение привязки к определенному
      поставщику программного обеспечения. MS SQL работает исключительно на
      <application>Windows NT/2000</application> (существуют так называемые
      персональные выпуски [personal editions], но они имеют ограничения по
      числу одновременных подключений и имеющимся функциям). Это означает, что
      Вы <quote>привязаны</quote> к операционным системам Microsoft.
      <application>Firebird</application> может работать на множестве платформ,
      включая Microsoft <application>Windows</application>,
      <application>Linux</application>, <application>Solaris</application>,
      <application>MacOS X</application> и другие.</para>

      <para>Еще одна причина для перехода - цена. <application>Firebird</application>
      бесплатен; за использование MS SQL необходимо платить за каждый процессор,
      на котором работает сервер MS SQL. Например, доступ к базе данных,
      расположенной на компьютере с dual-Pentium, через Интернет будет стоить
      $39998 (цены с <ulink
      url="http://www.microsoft.com/sql/productinfo/pricing.htm">сайта
      Microsoft</ulink> по состоянию на 2001.05.03).</para>

      <para>Последняя, но не менее важная, причина в том, что исходные коды
      <application>Firebird</application> открыты. Это означает не только то,
      что в мире существует сотни разработчиков, готовых помочь Вам использовать
      эту СУБД, улучшать ее, находить ошибки и т.д., но и даже то, что Вы
      самостоятельно можете вносить изменения в исходный код и собирать
      Вашу версию СУБД для удовлетворения Ваших потребностей. Добавление таких
      функций, как система электронной почты или система ведения лога, является
      несложным, если Вы понимаете исходный код и имеете знания и опыт для
      внесения изменений. Хотя изменение исходного кода под свои нужды не
      является тривиальной задачей, эта задача все-таки выполнима. Также это
      вносит большой уровень гибкости в СУБД.</para>
    </sect2>

    <sect2 id="migration-mssql-cons-ru">
      <title>Почему не нужно переходить на СУБД
      <application>Firebird</application></title>
      <titleabbrev>Почему не переходить</titleabbrev>

      <para>Прежде всего, если Ваша система работает без каких-либо проблем,
      то зачем Вам переходить на что-то другое? В этом случае Вы можете
      рассматривать СУБД <application>Firebird</application> для использования
      в своих будущих проектах. Не ломайте то, что работает.</para>

      <para>MS SQL 7 имеет несколько функций, которые Вы не найдете в СУБД
      <application>Firebird</application>, такие как встроенная поддержка
      репликации (эта поддержка доступна как дополнительный модуль к СУБД
      <application>Firebird</application>), временные таблицы и интеграция
      с другими СУБД посредством OLE DB. Также в MS SQL встроены сервисы
      анализа OLAP и полнотекстовый поисковый механизм (эта поддержка
      доступна как дополнительный модуль к СУБД
      <application>Firebird</application>).</para>

      <para>В СУБД MS SQL доступны инкрементные резервные копии (и
      восстановление из таких копий). <application>Firebird</application>
      резервирует и восстанавливает полную базу данных (инкрементные
      резервные копии станут доступны пользователям СУБД
      <application>Firebird</application>, начиная с версии 2.0 - прим.
      перев.).</para>

      <para>При работе с операционной системой Microsoft, СУБД MS SQL 7 и выше
      способна использовать учетные записи пользователей операционной системы.
      Однако эту функцию желательно не использовать для возможности портирования 
      и в связи с вопросами производительности.</para>

      <para>СУБД MS SQL 2000 также имеет встроенную поддержку работы с XML и
      поддержку разделенных представлений (partitioned views) для лучшей
      производительности при работе с таблицами, расположенными на
      нескольких серверах.</para>

      <para>В общем, кажется, что СУБД MS SQL более производительна на
      Windows, чем СУБД <application>Firebird</application> на этой
      операционной системе. Также, СУБД MS SQL имеет более тесную интеграцию
      с <application>Microsoft Visual Studio</application>.</para>
    </sect2>
  </sect1>

  <sect1 id="migration-mssql-db-setup-ru">
    <title>Установка сервера баз данных</title>
    <titleabbrev>Установка сервера</titleabbrev>

    <para>Этот раздел описывает различия при установке серверов баз
    данных.</para>

    <para>Для пользователей, ранее использовавших СУБД MS SQL и являющихся
    новичками в использовании СУБД <application>Firebird</application>, 
    вероятно, простота установки СУБД <application>Firebird</application> 
    будет некоторым приятным сюрпризом. Процесс установки не представляет 
    никаких проблем, Вы можете устанавливать соединение с базой данных сразу 
    после установки СУБД <application>Firebird</application>. Обратите
    внимание, что по умолчанию именем администратора СУБД 
    <application>Firebird</application> является <constant>SYSDBA</constant>, 
    и пароль <constant>masterkey</constant> (пароль при установке в ОС
    <application>Linux</application> генерируется произвольный или запрашивается
    у пользователя при установке - прим. перев.); в СУБД MS SQL соответственно 
    <constant>sa</constant> и пустой пароль.</para>

    <para>Заметьте, что Вам не нужно осуществлять выбор используемого набора
    символов и способ их сортировки при установке СУБД
    <application>Firebird</application>. В СУБД MS SQL Вы не только должны
    указать эту информацию при установке, но и, в случае необходимости
    изменения, Вам необходимо будет переустановить СУБД и указать новые
    параметры. В дополнение к этому, другие программные пакеты, такие как
    <application>Microsoft Commerce Server</application>, могут отказываться 
    работать с СУБД MS SQL, если Вы выберите неверные значения 
    параметров.</para>

    <para>В отличие от СУБД MS SQL 6.5, СУБД <application>Firebird</application> 
    не имеет понятия <quote>утройства</quote> (devices). Все данные хранятся в
    обычных файлах доступной файловой системы. Имейте в виду, что Вы не сможете 
    использовать <quote>чистые</quote> разделы диска (raw disk partition, разделы 
    без файловой системы) для хранения Ваших баз данных.</para>

    <para><emphasis>Важное замечание</emphasis>: СУБД MS SQL использует
    механизм журналирования (логи, logs) для сохранения целостности
    баз данных, в том числе при непредвиденных сбоях. СУБД
    <application>Firebird</application> использует многоверсионную
    архитектуру (multi-generation architect, MGA) для создания копии (версии)
    записи <quote>на месте</quote>, если это необходимо (например, при 
    модификации); но запись новой версии записи на диск может быть отложена, 
    что может дать некоторый выигрыш в скорости работы СУБД. Для каждой базы 
    данных Вы можете установить атрибут <varname>Forced Writes</varname> 
    (принудительная запись) - рекомендуется устанавливать этот атрибут, чтобы 
    быть уверенным в целостности базы данных в различных чрезвычайных ситуациях, 
    таких как исчезновение питания и т.п. В случае уверенности в конфигурации 
    оборудования, Вы можете не устанавливать этот атрибут (например, для 
    выделенного сервера <application>Linux</application>, наличии источников 
    бесперебойного питания и т.д.).</para>
  </sect1>

  <sect1 id="migration-mssql-db-admin-ru">
    <title>Администрирование баз данных</title>
    <titleabbrev>Администрирование</titleabbrev>

    <para>Этот раздел описывает различия в управлении базами данных между
    СУБД <application>Firebird</application> и СУБД MS SQL.</para>

    <sect2 id="migration-mssql-db-admin-files-ru">
      <title>Управление файлами базы данных</title>
      <titleabbrev>Файлы</titleabbrev>

      <para>СУБД MS SQL 6.5 использует устройства (devices), которые могут
      представлять собой файлы или <quote>чистые</quote> разделы (raw 
      partitions, разделы без файловой системы), чтобы работать с данными. 
      Это ведет к сложным для поддержки системам. СУБД MS SQL 7 и MS SQL 2000 
      используют обычные файлы вместо устройств. Для каждой базы данных 
      создаются, как минимум, два файла: один, собственно, для хранения данных, 
      и второй - для сохранения журнала выполненных транзакций.</para>

      <para>СУБД <application>Firebird</application> не использует отдельный 
      журнал для сохранения выполненных транзакций, и поэтому использует 
      единственный файл для хранения всех данных.</para>

      <para>Оператор <command>CREATE DATABASE</command> (<quote>создать базу 
      данных</quote>) в СУБД <application>Firebird</application>
      проще, чем аналогичный оператор в СУБД MS SQL. Обратитесь к справочнику
      SQL для подробного описания всех возможностей.</para>

      <para>Существенное различие в модели управления файлами - это
      использование СУБД групп файлов (filegroups) для деления базы данных
      на несколько наборов файлов по определенному принципу. СУБД 
      <application>Firebird</application> так же может работать с разбитой на 
      несколько файлов базой данных, но модель работы с файлами более проста 
      (в смысле принципа, из которого производится разбиение на файлы - 
      прим. перев.).</para>

      <para>Дополнительная возможность, предоставляемая СУБД
      <application>Firebird</application> -
      это использование теневых файлов (shadow files). Теневые файлы являются
      немедленной копией исходной базы данных. Обычно они используются для
      быстрого получения актуальной копии. В СУБД MS SQL нет такой функции,
      хотя СУБД MS SQL 2000 имеет похожую функцию при использовании журналов,
      перемещенных между серверами, и репликации.</para>
    </sect2>

    <sect2 id="migration-mssql-db-admin-users-ru">
      <title>Администрирование пользователей</title>
      <titleabbrev>Пользователи</titleabbrev>

      <para>СУБД MS SQL 6.5 предоставляет два объекта для управления:
      <quote>логины</quote> и <quote>пользователи</quote>. <quote>Логин</quote> 
      определяет комбинацию имени пользователя и пароля для досутпа к серверу 
      базы данных; <quote>пользователь</quote> определяет права доступа для 
      каждой базы данных. <quote>Логины</quote> отображаются на
      <quote>пользователей</quote> в базе данных.</para>

      <para>В СУБД MS SQL 7 добавлен новый объект управления группами
      пользователей - <quote>роли</quote>. <quote>Роль</quote> является 
      хранилищем прав. Некоторые <quote>роли</quote> являются предопределенными, 
      например, <quote>оператор создания копии базы данных</quote> или 
      <quote>администратор базы данных</quote>.</para>

      <para>СУБД <application>Firebird</application> предоставляет похожую 
      модель, но не включает в нее <quote>логины</quote>. Пользователи сообщают 
      серверу свое имя, пароль и <quote>роль</quote>, с правами которой они 
      хотят работать. Существует одна общая база данных для всего сервера баз
      данных, в которой хранится информация обо всех пользователях сервера 
      (их имена и пароли); информация о <quote>ролях</quote> и
      предоставленных каждому пользователю правах хранится в каждой конкретной
      базе данных. (Исходный документ имеет здесь неточность: там сказано, что в
      базе данных безопасности/пользователей хранится так же информация о
      <quote>ролях</quote> и разрешениях/запретах для каждого пользователя. Так же
      версия 2.0 СУБД <application>Firebird</application> вносит много изменений в 
      модель управления пользователями. - прим. перев.)</para>

      <para>В обоих СУБД считается хорошей практикой получать доступ к ресурсам
      через хранимые процедуры (stored procedures), и предоставлять доступ к
      данным только этим хранимым процедурам. (Это утверждение спорно и не
      может слепо применяться во всех случаях, по крайней мере, относительно
      СУБД <application>Firebird</application>. - прим. перев.)</para>
    </sect2>

    <sect2 id="migration-mssql-db-admin-backups-ru">
      <title>Операции резервного копирования и восстановления</title>
      <titleabbrev>Резервирование и восстановление</titleabbrev>

      <para>СУБД <application>Firebird</application> использует более простую 
      модель создания резервных копий баз данных и восстановления из них по 
      сравнению с СУБД MS SQL, хотя в качестве жертвы здесь принесена гибкость. 
      Резервное копирование может выполняться с помощью консольных (из 
      командной строки) и графических утилит, в любом случае производится 
      резервное копирование всей базы данных. Операция восстановления также 
      восстанавливает всю базу данных. Нет возможности создания резервной копии 
      только изменений, произошедших с момента создания последней резервной копии, 
      или восстановления изолированного набора транзакций. (В СУБД 
      <application>Firebird</application> 2.0 появилась возможность создания 
      инкрементных резервных копий. - прим. перев.)</para>

      <para>Обратите внимание, что при создании резервной копии базы данных
      СУБД <application>Firebird</application> существует важный параметр, 
      определяющий формат создаваемой резервной копии: платформозависимый или 
      платформонезависимый (переносимый). Создание резервной копии в 
      переносимом формате позволяет администратору базы данных создать ее 
      резервную копию в одной операционной системе, а затем восстановить базу 
      данных из этой копии в другой операционной системе. Обычно такая 
      возможность используется, например, при разработке приложения на 
      <application>Windows</application>, а затем переносе базы данных на более
      мощный сервер <application>Linux</application>. (Так же, это рекомендуемый 
      способ переноса баз данных с одного компьютера на другой даже для одной 
      операционной системы: простое копирование файла базы данных не 
      рекомендуется. - прим. перев.)</para>
    </sect2>
  </sect1>

  <sect1 id="migration-mssql-data-types-ru">
    <title>Типы данных</title>

    <para>Этот раздел описывает различные типы данных, доступные в СУБД
    <application>Firebird</application> и MS SQL, а также соответствия типов
    для перехода с одной системы на другую.</para>

    <para>Доступные типы данных СУБД MS SQL зависят от версии СУБД. В следующей
    таблице перечислены типы данных и версия СУБД, в которой они были
    введены.</para>

    <para><table>
        <title>Таблица соответствия типов данных</title>

        <tgroup cols="4" colsep="1" rowsep="1">
          <colspec align="center" colname="c1" colwidth="2*" />

          <colspec align="center" colname="c2" colwidth="3*" />

          <colspec align="center" colname="c3" colwidth="3*" />

          <colspec align="left" colname="c4" colwidth="6*" />

          <thead>
            <row>
              <entry align="center"><para>Вер. MSSQL</para></entry>

              <entry align="center"><para>Тип данных</para></entry>

              <entry align="center"><para>Тип Firebird</para></entry>

              <entry align="center"><para>Определение MSSQL и
              пояснения</para></entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>bigint</type> </para></entry>

              <entry><para><type>INT64</type> </para></entry>

              <entry><para>8-байтные целочисленные данные.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>binary</type> </para></entry>

              <entry><para><type>CHAR</type> </para></entry>

              <entry><para>Двоичные данные фиксированной длины. Максимальная
              длина 8000 байт. В версии 6.5 максимальная длина была 255
              байт.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>bit</type> </para></entry>

              <entry><para><type>CHAR(1)</type> </para></entry>

              <entry><para>Целочисленные данные со значениями только
              <constant>1</constant> или <constant>0</constant>. Обычно
              заменяются константами <constant>'T'</constant> и
              <constant>'F'</constant>. (В СУБД <application>Firebird</application>
              так же можно использовать тип <database>SMALLINT</database>
              со значениями <constant>0</constant> и <constant>1</constant>.
              - прим. перев.)</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>char</type> </para></entry>

              <entry><para><type>CHAR</type> </para></entry>

              <entry><para>Текстовые данные фиксированной длины (не-Unicode).
              Максимальная длина 8000 символов. В версии 6.5 максимальная
              длина была 255 байт. СУБД Firebird способна хранить до 32767
              символов.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>cursor</type> </para></entry>

              <entry><para></para></entry>

              <entry><para>Ссылка на курсор. Этот тип используется только в
              хранимых процедурах и триггерах; этот тип не может использоваться
              при объявлении структуры таблиц.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>datetime</type> </para></entry>

              <entry><para><type>TIMESTAMP</type> </para></entry>

              <entry><para>Дата и время с 1 января 1753 года до 31 декабря
              9999 года, точность 3/100 секунды (3.33 мс).</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>decimal</type> </para></entry>

              <entry><para><type>DECIMAL</type> </para></entry>

              <entry><para>Числовые данные с фиксированной точностью.
              Диапазон от -10<superscript>38</superscript>-1 до
              10<superscript>38</superscript>-1.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>float</type> </para></entry>

              <entry><para><type>FLOAT</type> </para></entry>

              <entry><para>Вещественные числовые данные. Диапазон от
              -1.79E+38 до 1.79E+38.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>image</type></para></entry>

              <entry><para><type>BLOB</type></para></entry>

              <entry><para>Двоичные данные переменной длины. Максимальная
              длина 2<superscript>31</superscript>-1 (2147483647)
              байт.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>int</type></para></entry>

              <entry><para><type>INTEGER</type></para></entry>

              <entry><para>4-байтные целочисленные данные. Диапазон от
              -2<superscript>31</superscript> (-2147483648) до
              2<superscript>31</superscript>-1
              (2147483647).</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>money</type></para></entry>

              <entry><para><type>DECIMAL(18,4)</type></para></entry>

              <entry><para>Денежные данные. Диапазон от
              -2<superscript>63</superscript> (-922337203685477.5808)
              до 2<superscript>63</superscript>-1
              (+922337203685477.5807), точность до 1/10000 денежной
              единицы.</para></entry>
            </row>

            <row>
              <entry><para>7</para></entry>

              <entry><para><type>nchar</type></para></entry>

              <entry><para><type>CHAR(x) CHARACTER SET
              UNICODE_FSS</type></para></entry>

              <entry><para>Символные данные фиксированной длины (Unicode).
              Максимальная длина 4000 символов.</para></entry>
            </row>

            <row>
              <entry><para>7</para></entry>

              <entry><para><type>ntext</type></para></entry>

              <entry><para><type>BLOB SUB_TYPE TEXT</type></para></entry>

              <entry><para>Символьные данные переменной длины (Unicode).
              Максимальная длина 2<superscript>30</superscript>-1
              (1073741823) символов.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>numeric</type></para></entry>

              <entry><para><type>NUMERIC</type></para></entry>

              <entry><para>В СУБД MS SQL decimal и numeric эквивалентны.
              </para></entry>
            </row>

            <row>
              <entry><para>7</para></entry>

              <entry><para><type>nvarchar</type></para></entry>

              <entry><para><type>VARCHAR(x) CHARACTER SET
              UNICODE_FSS</type></para></entry>

              <entry><para>Символьные данные переменной длины. Максимальная
              длина 4000 символов.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>real</type></para></entry>

              <entry><para><type>DOUBLE PRECISION</type></para></entry>

              <entry><para>Вещественные данные. Диапазон от -3.40E+308
              до 3.40E+308.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>smalldatetime</type></para></entry>

              <entry><para><type>TIMESTAMP</type></para></entry>

              <entry><para>Дата и время с 1 января 1900 года до 6 июня 2079
              года, точность 1 минута. Тип данных 
              <application>Firebird</application> имеет бОльшие
              диапазон и точность.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>smallint</type></para></entry>

              <entry><para><type>SMALLINT</type></para></entry>

              <entry><para>2-байтные целочисленные данные. Диапазон от
              -2<superscript>15</superscript> (-32768) до
              2<superscript>15</superscript>-1 (32767).</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>smallmoney</type></para></entry>

              <entry><para><type>DECIMAL(10,4)</type></para></entry>

              <entry><para>Денежные данные. Диапазон от -214748.3648 до
              +214748.3647, точность 1/10000 денежной единицы. Диапазон
              СУБД <application>Firebird</application> больше при указанной 
              замене.</para></entry>
            </row>

            <row>
              <entry><para>2000</para></entry>

              <entry><para><type>sql_variant</type></para></entry>

              <entry><para><type>BLOB</type></para></entry>

              <entry><para>Данные различных типов.</para></entry>
            </row>

            <row>
              <entry><para>2000</para></entry>

              <entry><para><type>table</type></para></entry>

              <entry><para>нет эквивалента</para></entry>

              <entry><para>Промежуточные результаты выполнения запроса
              для последующего использования.
              </para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>text</type></para></entry>

              <entry><para><type>BLOB SUB_TYPE TEXT</type></para></entry>

              <entry><para>Символьные данные переменной длины (не-Unicode).
              Максимальная длина 2<superscript>31</superscript>-1 (2147483647)
              символов.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>timestamp</type></para></entry>

              <entry><para><type>INTEGER или BIGINT</type></para></entry>

              <entry><para>Уникальное для базы данных число. В СУБД 
              <application>Firebird</application> Вам необходимо использовать 
              механизм генераторов для этих целей.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>tinyint</type> </para></entry>

              <entry><para><type>SMALLINT</type></para></entry>

              <entry><para>1-байтовое целочисленное значение без знака.
              Диапазон от 0 до 255. В СУБД <application>Firebird</application> 
              нет эквивалентного типа.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>varbinary</type></para></entry>

              <entry><para><type>VARCHAR<!-- source document (in English) has CHAR here --></type></para></entry>

              <entry><para>Двоичные данные переменной длины.
              Максимальная длина 8000 байт.</para></entry>
            </row>

            <row>
              <entry><para>6.5</para></entry>

              <entry><para><type>varchar</type></para></entry>

              <entry><para><type>VARCHAR</type></para></entry>

              <entry><para>Символьные данные переменной длины (не-Unicode).
              Максимальная длина 8000 символов. СУБД
              <application>Firebird</application> способна
              хранить до 32765 символов. В СУБД MS SQL 6.5 максимум был
              255 символов.</para></entry>
            </row>

            <row>
              <entry><para>7</para></entry>

              <entry><para><type>uniqueidentifier</type></para></entry>

              <entry><para><type>CHAR(36)</type></para></entry>

              <entry><para>Глобально уникальный идентификатор (GUID).
              В СУБД <application>Firebird</application> Вам неоходимо 
              использовать функции, определяемые пользователем (UDF), для 
              генерации значения идентификатора.
              (Если Вы собираетесь индексировать поле с глобально уникальными
              идентификаторами, то лучше использовать UUID - это другой формат
              представления GUID, представляемый как CHAR(22). - прим.
              перев.)</para></entry>
            </row>
          </tbody>
        </tgroup>
      </table></para>

    <para>Небольшое различие в поведении в СУБД 
    <application>Firebird</application> между типами
    <type>NUMERIC</type> и <type>DECIMAL</type>, которое приходит на ум,
    заключается в том, что определение <type>NUMERIC</type> означает
    <emphasis>четко</emphasis> указанную точность (общее число цифр),
    в то время как <type>DECIMAL</type> одначает <emphasis>как
    минимум</emphasis> указанную точность. В СУБД MS SQL оба типа
    <type>numeric</type> и <type>decimal</type> эквивалентны.</para>

    <para>Существует также квази-тип данных - <type>identity</type>
    (идентификатор), который может использоваться только для указания в
    определениях таблиц. Фактически, это тип данных <type>int</type>, значение
    поля автоматически генерируется при добавлении новой записи и не может
    быть впоследствии изменено.</para>

    <sect2 id="migration-mssql-data-types-bit-ru">
      <title>Перенос типа данных <type>bit</type></title>
      <titleabbrev>Перенос типа <type>bit</type></titleabbrev>

      <para>Тип данных <type>bit</type> используется для хранения булевого
      (логического) значения, <constant>0</constant> или <constant>1</constant>. 
      СУБД MS SQL не поддерживает присваивание значения NULL таким полям. 
      Пользователи СУБД <application>Firebird</application> могут эмулировать
      поведение логического типа, используя типы <type>SMALLINT</type> или
      <type>CHAR(1)</type>.</para>

      <para>Возможные значения полей логического типа в СУБД 
      <application>Firebird</application> могут быть ограничены через 
      использование доменов (domains).</para>
    </sect2>

    <sect2 id="migration-mssql-data-types-identity-ru">
      <title>Перенос типа данных <type>identity</type> (идентификатор)</title>
      <titleabbrev>Перенос типа <type>identity</type></titleabbrev>

      <para>Существует несколько способов переноса механизма идентификаторов
      СУБД MS SQL. В общем, СУБД <application>Firebird</application> имеет 
      бОльшую гибкость и мощь в этом вопросе.</para>

      <para>Самый простой способ создаия аналога типа <type>identity</type>
      - создание триггера <command>BEFORE INSERT</command> (перед вставкой 
      новой записи в базу данных) для интересующей Вас таблицы, и в этом 
      триггере присваивать очередное значение генератора. Такой метод 
      гарантирует уникальность (при условии, что шаг для генератора отличен 
      от нуля и всегда имеет один и то же знак - прим. перев.).</para>

      <para>Для дополнительной гибкости, можно использовать один генератор
      для всех таблиц. В этом случае получится аналог типа
      <type>timestamp</type> - уникального для всей базы данных
      идентификатора.</para>

      <para>Еще одна обычная техника - создание хранимой процедуры, которая
      возвращает очередное значение генератора. Это так же позволяет
      получать значение генератора и использовать его для нескольких
      операций (например, при добавлении записи в основную таблицу, а затем
      добавлении нескольких записей в подчиненную таблицу).</para>

      <programlisting>CREATE TABLE my_table (
  my_number integer not null primary key
) </programlisting>

      <programlisting>CREATE GENERATOR my_generator</programlisting>

      <programlisting>CREATE TRIGGER my_before_trigger FOR my_table
BEFORE INSERT
AS
BEGIN
  IF (NEW.my_number IS NULL)
    THEN NEW.my_number = GEN_ID(my_generator, 1);
END </programlisting>

      <programlisting>CREATE PROCEDURE get_my_generator
RETURNS (new_value INTEGER)
AS
BEGIN
  new_value = GEN_ID(my_generator, 1);
END </programlisting>
    </sect2>

    <sect2 id="migration-mssql-data-types-uniqueidentifier-ru">
      <title>Перенос типа данных <type>uniqueidentifier</type>
      (глобально уникальный идентификатор)</title>
      <titleabbrev>Перенос типа <type>uniqueidentifier</type></titleabbrev>

      <para>В СУБД MS SQL тип <type>uniqueidentifier</type> используется
      для репликации. Также это простой способ определения уникальных
      глобальных идентификаторов для записей базы данных.</para>

      <para>Для использования аналогичного типа данных в СУБД
      <application>Firebird</application> создайте триггер
      <command>BEFORE INSERT</command> (перед вставкой новой записи) для
      интересующей Вас таблицы с полем типа <type>uniqueidentifier</type>,
      и используйте значение функции, определяемой пользователем (UDF),
      для получения очередного значения GUID.</para>

      <para>Вы можете использовать библиотеку <filename>uuidUDF</filename> 
      (прим. перев.):</para>
      <programlisting>/**************************************************************
UUID_CREATE
Returns a UUID (cstring(22), compressed, reversed,
  URL compatible UUID)
Parameters: cstring(22)	dummy to allow Interbase to perform
  memory management
Returns:    cstring(22)
**************************************************************/
DECLARE EXTERNAL FUNCTION UUID_CREATE
  CSTRING(22)
  RETURNS PARAMETER 1
  ENTRY_POINT 'fn_uuid_create' MODULE_NAME 'uuidlib';

/**************************************************************
GUID_CREATE
Returns a GUID (cstring(36), standard readable representation
of a UUID in the xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx format)
Parameters: cstring(36)	dummy to allow Interbase to perform
  memory management
Returns:    cstring(36)
**************************************************************/
DECLARE EXTERNAL FUNCTION GUID_CREATE
  CSTRING(36)
  RETURNS PARAMETER 1
  ENTRY_POINT 'fn_guid_create' MODULE_NAME 'uuidlib'; </programlisting>
    </sect2>
  </sect1>

  <sect1 id="migration-mssql-syntax-ru">
    <title>Синтакс SQL</title>

    <para>Этот раздел описывает основные различия в синтаксе языка SQL,
    используемого СУБД <application>Firebird</application> и MS SQL.</para>

    <para>СУБД <application>Firebird</application> и MS SQL могут ссылаться
    на объекты базы данных (таблицы, поля и т.д.) по их именам напрямую, если
    имена объектов не содержат пробелы и другие недопустимые в прямой ссылке
    символы (например, нелатинские буквы). Для использования пробелов и других
    символов СУБД MS SQL использует квадратные скобки, <constant>[</constant> и 
    <constant>]</constant>, а СУБД <application>Firebird</application> 
    использует двойные кавычки, <constant>"</constant>. Еще одно различие - 
    возможность использования в СУБД MS SQL схемы для ссылки на объект: 
    <database>база_данных.владелец_объекта.объект</database>. СУБД
    <application>Firebird</application> не допускает такой нотации.</para>

    <warning>
      <para>СУБД MS SQL использует регистро-зависимые имена объектов, если
      при установке Вы выбрали использование различения регистра символов;
      в противном случае, имена объектов регистро-независимы. Весело?
      Не очень...</para>
    </warning>

    <tip>
      <para>СУБД MS SQL способна работать с идентификаторами, имена которых
      заключены в двойные кавычки, но по умолчанию эта возможность доступна
      только при доступе через OLE DB и ODBC, но не при доступе через
      DB-Library. По этой причине такую практику работы следует
      избегать.</para>
    </tip>

    <para>СУБД MS SQL 7 и выше поддерживает обновляемые соединения (joins)
    (обновление, удаление, вставка). СУБД <application>Firebird</application>
    не распознает такой синтакс.</para>

    <para>Типы даных, конечно, различаются. Хотя обе СУБД имеют общее
    подмножество наиболее часто используемых типов. Этот вопрос редко
    вызывает проблемы при переносе базы данных.</para>

    <para>Различаются встроенные функции. Большинство из встроенных функций
    СУБД MS SQL можно заменить в СУБД <application>Firebird</application> 
    использованием функций, определяемых пользователем (UDFs).</para>

    <para>Различаются форматы указания строковых констант для дат. СУБД
    <application>Firebird</application> принимает строки различных форматов,
    вне зависимости от используемой платформы. СУБД MS SQL, в свою очередь,
    использует совмещение серверо-независимых, серверо-платформенных
    форматов и формата настройки клиентского соединения. Дополнительно,
    методы доступа СУБД MS SQL обычно вводят один или два уровня, в которых
    строковая константа может быть преобразована в дату тем или иным
    образом.</para>

    <para>В СУБД MS SQL можно определять бОльшее количество переменных
    окружения, чем в СУБД <application>Firebird</application>, но наиболее
    общие можно найти и в СУБД <application>Firebird</application> (извлечение 
    идентификатора и имени пользователя). Единственная важная переменная, 
    которая отсутствует в СУБД <application>Firebird</application>, - это 
    переменная, возвращающая количество строк последней операции (с версии 
    1.5 СУБД <application>Firebird</application> такая переменная введена -
    прим. перев.).</para>

    <para>Важное различие было в том, что СУБД
    <application>Firebird</application> 1.0 не поддерживала оператор
    <database>CASE</database> СУБД MS SQL. Иногда можно было заменить его
    функциональность использованием хранимой процедуры. Начиная с версии 1.5,
    СУБД <application>Firebird</application> поддерживает использование
    оператора <database>CASE</database>.</para>

    <para>Небольшое различие между СУБД еще и в том, что СУБД MS SQL не
    использует разделителей для операторов, что может служить источником
    трудно обнаруживаемых ошибок при переходе, особенно при использовании
    множества скобок. СУБД <application>Firebird</application> в скриптах
    требует завершать каждый оператор точкой с запятой (если не определен
    другой разделитель - прим. перев.), поэтому ошибки легче
    обнаружить.</para>

    <para>Обе СУБД MS SQL и <application>Firebird</application> поддерживают
    комментарии, заключенные между разделителями <constant>/*</constant> и 
    <constant>*/</constant>. СУБД MS SQL также поддерживает синтакс
    <quote>два дефиса</quote> <constant>--</constant> для однострочного
    комментария. Некоторые утилиты для СУБД
    <application>Firebird</application> также поддерживают такой
    синтакс.</para>

    <sect2 id="migration-mssql-syntax-basics-ru">
      <title>Основы использования баз данных</title>
      <titleabbrev>Основы использования БД</titleabbrev>

      <para>СУБД MS SQL позволяет клиентам обращаться к нескольким базам
      данных через одно и то же соединение. Для этого при обращении к
      объектам баз данных необходимо использовать нотацию
      <database>база_данных.владелец_объекта.объект</database>, либо явно 
      использовать оператор <database>USE</database>.</para>

      <para>СУБД <application>Firebird</application> не допускает использование
      нескольких баз данных в одном операторе SQL. Однако эта СУБД позволяет
      клиенту работать с транзакциями, охватывающими несколько баз
      данных.</para>

      <para>Существует много утилит для ввода и выполнения операторов SQL для
      обоих платформ. Имейте в виду, что для СУБД
      <application>Firebird</application> не нужно вводить команду
      <database>GO</database> для разделения пакетов команд, как для пакетов
      T-SQL - Вы обычно управляете транзакциями явно. Также, Вы можете для
      обоих СУБД использовать настройку <quote>подтверждать (commit) каждый
      оператор</quote>.</para>

      <warning>
        <para>Если Вы установили СУБД MS SQL и
        <application>Firebird</application> на один компьютер, будьте
        внимательны при использовании утилиты <filename>isql</filename>.
        Если Вы не указываете при запуске этой утилиты полный путь,
        будет запущена та, что первой будет найдена по путям для поиска
        файлов, а обе СУБД имеют в своем составе программу с именем
        <filename>isql</filename>.</para>
      </warning>
    </sect2>

    <sect2 id="migration-mssql-syntax-variables-ru">
      <title>Использование переменных</title>

      <para>Управление переменными схоже на обоих платформах. Переменные
      необходимо объявлять до их использования, а также указать их тип.
      В СУБД <application>Firebird</application> нет необходимости добавлять 
      к имени переменной префикс <constant>@</constant>, а также переменные 
      обязательно должны быть объявлены до тела хранимой процедуры или 
      триггера.</para>

      <para>Например, сравните следующие части кода.</para>

      <programlisting>/* MS-SQL */
CREATE PROCEDURE my_procedure
AS
DECLARE @my_variable int
SET @my_variable = 5</programlisting>

      <programlisting>/* Firebird */
CREATE PROCEDURE my_procedure
AS
DECLARE VARIABLE my_variable int;
BEGIN
  my_variable = 5;
END </programlisting>

      <para>В обоих СУБД параметры считаются обычными переменными с
      установленным начальным значением.</para>
    </sect2>

    <sect2 id="migration-mssql-syntax-flowcontrol-ru">
      <title>Управляющие конструкции</title>

      <sect3>
        <title><database>BEGIN..END</database></title>

        <para>В обоих СУБД ключевые слова <database>BEGIN</database> и
        <database>END</database> могут использоваться для объединения
        нескольких операторов в один блок, например, при использовании
        в условном операторе <database>IF</database>.</para>
      </sect3>

      <sect3>
        <title><database>GOTO</database></title>

        <para>СУБД <application>Firebird</application> не имеет оператора
        <database>GOTO</database>. Однако, как правило, это к лучшему. Оператор
        <database>GOTO</database> обычно используется СУБД MS SQL, потому что
        по умолчанию возникающие при выполнении операторов ошибки не откатывают
        транзакции, необходимо после выполнения каждого оператора проверять
        значение переменной <varname>@@ERROR</varname>; оператор
        <database>GOTO</database> используется для объединения в группы
        операторов управления ошибками. В СУБД <application>Firebird</application>
        используется более удачный механизм управления ошибками - оператор
        <database>WHEN...DO</database>.<!-- TODO: insert reference to docs here. --></para>

        <para>Конечно, оператор <database>GOTO</database> может использоваться
        и для других целей. В таком случае, правильное использование хранимых
        процедур обычно улучшает дизайн базы данных.</para>
      </sect3>

      <sect3>
        <title><database>IF</database></title>

        <para>Оператор <database>IF..ELSE</database> в СУБД 
        <application>Firebird</application> имеет ту же семантику, что и в 
        СУБД MS SQL, однако синтакс СУБД <application>Firebird</application>
        требует наличия ключевого слова <database>THEN</database> после 
        условия.</para>

        <programlisting>IF (something = 'unknown')
  THEN something = 'uuhhh.....';
  ELSE something = 'I know! I know!';  </programlisting>
      </sect3>

      <sect3>
        <title><database>CASE</database></title>

        <para>СУБД <application>Firebird</application> 1.0 не поддерживает 
        оператор <database>CASE</database>, поэтому Вам необходимо будет 
        сделать дополнительную работу по переносу, если Вы использовали этот 
        оператор в базе данных СУБД MS-SQL.</para>

        <para>Вы можете <link linkend="migration-mssql-end-of-case-sect-ru">пропустить
        этот раздел</link>, если Вы используете СУБД 
        <application>Firebird</application> 1.5 или более новую версию, так как, 
        начиная с версии 1.5, СУБД <application>Firebird</application> имеет
        поддержку оператора <database>CASE</database>.</para>

        <para>Оператор <database>CASE</database> используется аналогично
        оператору <code>switch</code> языка <application>C</application> или 
        оператору <code>case</code> языка <application>Pascal</application> для 
        замены одного значения на другое. Обычно в СУБД 
        <application>Firebird</application> 1.0 эту операцию можно эмулировать
        хранимой процедурой, возвращающей некоторое значение.</para>

        <programlisting>/* Это исходный оператор MS SQL,
   использующий традиционную базу данных pubs. */
CREATE PROCEDURE list_states
AS
SELECT
  CASE state
    WHEN 'CA' THEN 'California'
    WHEN 'UT' THEN 'Utah'
    ELSE 'unknown'
  END
FROM authors </programlisting>

        <programlisting>/* Это вариант перевода в СУБД Firebird 1.0. */
/* Выделить оператор CASE. */
CREATE PROCEDURE get_state_name ( state_code char(2) )
RETURNS ( state_name varchar(64) )
AS
BEGIN
 IF (state_code = 'CA') THEN state_name = 'California';
 ELSE IF (state_code = 'UT') THEN state_name = 'Utah';
 ELSE state_name = 'unknown';
END

/* Это процедура-выборка. */
CREATE PROCEDURE list_states
RETURNS (state varchar(64))
AS
DECLARE VARIABLE short_state CHAR(2);
BEGIN
  FOR SELECT state FROM authors INTO :short_state DO
  BEGIN
    EXECUTE PROCEDURE get_state_name :short_state
    RETURNING_VALUES :state;
    SUSPEND;
  END
END </programlisting>

        <!-- To test the above script, execute first: CREATE TABLE authors ( state char(2), au_lname varchar(40) ) insert into authors values ('UT', 'pepe') insert into authors values ('CA', 'pide') insert into authors values ('CA', 'la') insert into authors values ('MI', 'papa') Test with: select * from list_states -->

        <para>Три замечания по приведенному примеру. Во-первых, перенос
        является тривиальным. Во-вторых, текст получается довольно ясным.
        В-третьих, использование хранимой процедуры вносит бОльшую гибкость
        и простоту внесения изменений логики. Предположим, оператор
        <database>CASE</database> для поля <database>state</database>
        встречается в 12 различных процедурах, и был добавлен новый штат,
        или что Вы неправильно написали название штата... Совершенно ясно,
        что лучше выполнить указанное преобразование для использования
        хранимой процедуры.</para>

        <para>Еще раз: с версии 1.5 СУБД <application>Firebird</application> 
        полностью поддерживает оператор <database>CASE</database>, поэтому, 
        в принципе, необходимости перехода на использование хранимых процедур
        нет.<anchor id="migration-mssql-end-of-case-sect-ru" /></para>
      </sect3>

      <sect3>
        <title><database>WHILE</database></title>

        <para>Оператор <database>WHILE</database> существует в обоих СУБД
        <application>Firebird</application> и MS SQL, но с некоторыми
        различиями. Не существует операторов <database>BREAK</database> или
        <database>CONTINUE</database>, но их можно эмулировать при помощи
        дополнительных конструкций. Так же есть небольшое различие в
        используемом синтаксисе: СУБД <application>Firebird</application>
        требует наличия ключевого слова <database>DO</database> после
        условия цикла. Сравните следующие эквивалентные части кода.</para>

        <programlisting>/* Синтакс Firebird. */
WHILE (i &lt; 3) DO
BEGIN
  i = i + 1;
  j = j * 2;
END </programlisting>

        <programlisting>/* Синтакс MS SQL. */
WHILE (i &lt; 3)
BEGIN
  SET @i = @i + 1
  SET @j = @j * 2
END  </programlisting>
      </sect3>

      <sect3>
        <title><database>RETURN</database></title>

        <para>Оператор <database>RETURN</database> в СУБД MS SQL возвращает
        значение целочисленной переменной и прекращает выполнение. В СУБД
        <application>Firebird</application> существует оператор
        <database>EXIT</database>, который передает управление на заключительный
        <database>END</database> хранимой процедуры. Однако здесь нет скрытой
        возвращаемой переменной, поэтому, если Вам необходимо вернуть
        некоторое значение (что опционально в СУБД MS SQL), Вы должны явно
        объявить возвращаемую переменную в процедуре.</para>
      </sect3>

      <sect3>
        <title><database>WAITFOR</database></title>

        <para>Оператор <database>WAITFOR</database> в СУБД MS SQL приостанавливает
        выполнение на некоторое время или до наступления указанного времени.
        Что-то подобное можно осуществить при помощи функций, определяемых
        пользователем (UDFs), в СУБД <application>Firebird</application>. Но в
        обоих СУБД использование такого оператора следует исключить,
        поскольку взаимодействие с клиентом полностью приостанавливается
        (в СУБД <application>Firebird</application> это может привести и к 
        приостановке обслуживания всех соединений, а не только соединения, 
        вызвавшего аналог указанного оператора - прим. перев.).</para>
      </sect3>
    </sect2>

    <sect2 id="migration-mssql-syntax-statements-ru">
      <title>Стандартные операторы</title>

      <para>Стандартными операторами, имеющимися в обоих СУБД, являются
      <database>SELECT</database>, <database>INSERT</database>,
      <database>UPDATE</database> и <database>DELETE</database>.
      СУБД <application>Firebird</application> и MS SQL поддерживают их, но в
      СУБД MS SQL есть несколько нестандартных расширений этих операторов, о
      которых необходимо рассказать на случай их использования.</para>

      <para>В СУБД <application>Firebird</application> оператор
      <database>SELECT</database> не позволяет использовать ключевое слово
      <database>INTO</database> для создания новой таблицы 
      <quote>на лету</quote>. Вместо этого, ключевое слово 
      <database>INTO</database> используется для связи результата запроса с 
      переменной.</para>

      <programlisting>/* Синтаксис MS SQL для присваивания значения поля переменной. */
SELECT @my_state = state
FROM authors
WHERE auth_name = 'John'</programlisting>

      <programlisting>/* Синтаксис Firebird. */
SELECT state INTO :state /* --&gt; обратите внимание на
                            ":" перед именем переменной */
FROM authors
WHERE auth_name = 'John'</programlisting>

      <para>В СУБД MS SQL 7 и выше в операторе <database>SELECT</database>
      можно указвать спецификатор <database>TOP</database> для органичения
      возвращаемого набора данных. Эта функция в настоящий момент находится
      в стадии разработки для СУБД <application>Firebird</application>.
      (Спецификаторы <database>FIRST</database> и <database>SKIP</database>
      в СУБД <application>Firebird</application> введены, начиная с версии 
      1.5. - прим. перев.)</para>

      <para>Обе СУБД MS SQL и <application>Firebird</application> поддерживают
      обычный синтаксис оператора <database>INSERT</database> и оператора
      <database>INSERT..SELECT</database>.</para>

      <para>Обе СУБД MS SQL и <application>Firebird</application> поддерживают
      обычный синтаксис оператора <database>UPDATE</database>. СУБД MS SQL также
      поддерживает синтаксис оператора <database>UPDATE</database>, в котором
      выполняется соединение (join) и производится обновление одной из таблиц
      соединения. Можно думать об этом как об условии <database>WHERE</database>
      на стероидах. Если такая функция очень нужна, то ее можно реализовать в
      СУБД <application>Firebird</application> с использованием представлений 
      (views).</para>

      <para>Обе СУБД MS SQL и <application>Firebird</application> поддерживают
      обычный синтаксис оператора <database>DELETE</database>. СУБД MS SQL также
      поддерживает оператор <database>TRUNCATE TABLE</database>, который более
      эффективен (но и опаснее), чем оператор <database>DELETE</database>.
      (СУБД MS SQL также поддерживает синтаксис оператора
      <database>DELETE</database>, в котором выполняется соединение. - прим.
      перев.)</para>

      <programlisting>/* Синтаксис MS SQL для удаления всех записей my_table. */
TRUNCATE TABLE my_table /* ...или... */
DELETE FROM my_table </programlisting>

      <programlisting>/* Синтаксис Firebird. */
DELETE FROM my_table </programlisting>

      <blockquote>
        <attribution>Jim Starkey<!-- http://groups.yahoo.com/group/IB-Architect/message/3051 Thu Jan 11, 2001 9:24 pm --></attribution>

        <para>Самая большая угроза - действовать <quote>методом тыка</quote>. 
        Больше всего данных было утеряно командами 
        "<database>delete from xxx</database>" и
        последующей "<database>ой!</database>", чем продуманной командой 
        "<database>delete from rdb$pages</database>".</para>
      </blockquote>
    </sect2>

    <sect2 id="migration-mssql-syntax-transactions-ru">
      <title>Использование транзакций</title>
      <titleabbrev>Транзакции</titleabbrev>

      <para>В СУБД <application>Firebird</application> в DSQL (dynamic SQL)
      транзакции <quote>напрямую</quote> не используются. Именованные 
      транзакции в этом случае недоступны совсем. (Операторы DSQL выполняются 
      в контексте транзакций, запущенных и контролируемых клиентским 
      приложением.- прим. перев.) Синтаксис обоих СУБД поддерживает ключевое 
      слово <database>WORK</database> для совместимости.</para>

      <para>В большинстве случаев проблем с транзакциями не должно возникать:
      явное управление транзакциями <quote>на месте</quote> в СУБД MS SQL 
      используется обычно из-за отсутствия поддержки управлением через 
      исключения (exceptions).</para>

      <tip>
        <para>В СУБД MS SQL есть глобальная переменная
        <varname>XACT_ABORT</varname>, которая управляет откатом транзакции
        при возникновении ошибки времени выполнения (run-time error).
        В противном случае Вам необходимо проверять значение переменной
        <varname>@@ERROR</varname> после выполнения каждого оператора.</para>
      </tip>

      <para>В общем, большинство проблем, связанных с уровнями изоляции
      транзакций в СУБД MS SQL, пропадают при переходе на СУБД
      <application>Firebird</application>. Соперничество между 
      <quote>читателями</quote> и <quote>писателями</quote> минимально за счет 
      использования многоверсионной архитектуры (multigeneration architecture, 
      MGA).</para>
    </sect2>

    <sect2 id="migration-mssql-sql-cursors-ru">
      <title>Использование курсоров</title>
      <titleabbrev>Курсоры</titleabbrev>

      <para>В СУБД MS SQL курсоры используются, в основном, для перемещения
      по результатам запросов, чтобы выполнить с этими результатами некоторые
      действия. Кроме синтаксиса, нет большой разницы для выполнения одной и
      той же задачи. Хотя существуют опции для перемещения вперед и назад,
      на практике используются, по большей части, однонаправленные
      курсоры.</para>

      <programlisting>/* Синтакс MS SQL. */
DECLARE my_cursor CURSOR
FOR SELECT au_lname FROM authors ORDER BY au_lname
  DECLARE @au_lname varchar(40)
  OPEN my_cursor
  FETCH NEXT FROM my_cursor INTO @au_lname
  WHILE @@FETCH_STATUS = 0
  BEGIN
    /* Сделать что-то интересное с @au_lname. */
    FETCH NEXT FROM my_cursor
  END
CLOSE my_cursor
DEALLOCATE my_cursor </programlisting>

      <programlisting>/* Синтакс Firebird. */
DECLARE VARIABLE au_lname VARCHAR(40);
  ...
  FOR SELECT au_lname FROM authors
  ORDER BY au_lname INTO :au_lname DO
  BEGIN
    /* Сделать что-то интересное с au_lname. */
  END </programlisting>

      <para>Заметьте, что СУБД MS SQL может размещать курсоры в переменных,
      и передавать эти переменные как параметры; это невозможно в СУБД
      <application>Firebird</application>.</para>

      <warning>
        <para>Различные версии СУБД MS SQL имеют различные области видимости
        для переменных-курсоров. Будьте осторожны при их использовании и при
        переносе кода.</para>
      </warning>
    </sect2>
  </sect1>

  <!--FIXME : Something wrong with the sectioning here. Is "SQL Tricks" supposed to be a subsection
      of "Server-Side SQL", or is the latter just waiting to be filled with content?-->
<!-- commented out by PM because of the misunderstanding above
  <sect1 id="migration-mssql-sql-server-side-ru">
    <title>SQL на стороне сервера</title>
    <titleabbrev>Серверный SQL</titleabbrev>

    <para>Этот раздел идет дальше рассмотрения различий в синтаксисе простых
    операторов SQL, и описывает различные задачи, которые могут быть решены
    средствами языка SQL на стороне сервера баз данных.</para>

  </sect1>
-->
  <sect1 id="migration-mssql-sql-tricks-ru">
    <title>Трюки с SQL</title>

    <para>Этот раздел описывает некоторые трюки СУБД
    <application>Firebird</application>, используемые для эмуляции поведения
    СУБД MS SQL и для исключения <quote>обходных путей</quote> СУБД MS
    SQL.</para>

    <sect2 id="migration-mssql-sql-tricks-cascades-ru">
      <title>Трюк: использование каскадных изменений</title>
      <titleabbrev>Каскадные изменения</titleabbrev>

      <para>Версии СУБД MS SQL до 2000 не поддерживают каскадные обновления
      и удаления. Ссылочные ключи при изменениях всегда откатывались
      (rolled back).</para>

      <para>В СУБД MS SQL указанная проблема решается комбинированием хранимых
      процедур и триггеров, и вместе с тем исключается явная декларация
      ссылочной целостности (foreign key). В свою очередь, такое поведение
      делает ссылочную целостность неявной вместо наличия явно декларируемой
      ссылочной целостности, а это означает, что различные утилиты не смогут
      распознавать наличие отношений между таблицами и работать с этими
      отношениями.</para>

      <para>При переносе базы данных все такие <quote>обходные пути</quote> 
      могут быть опущены - СУБД <application>Firebird</application> полностью
      поддерживает каскадные обновления и удаления через декларативную
      ссылочную целостность. (СУБД <application>Firebird</application> до 
      версии 2.0 имеет проблемы с индексами с низкой селективностью, которые 
      часто образуются и используются в реализации декларативной ссылочной 
      целостности, и ситуация с которыми усугубляется нежелательностью создания 
      параллельных индексов с хорошей селективностью во избежание введения 
      оптимизатора в заблуждение. Версия 2.0 решает эту проблему. -
      прим. перев.)</para>
    </sect2>

    <sect2 id="migration-mssql-sql-tricks-views-ru">
      <title>Трюк: использование обновляемых представлений (views)</title>
      <titleabbrev>Обновляемые представления</titleabbrev>

      <para>Версии СУБД MS SQL до 2000 не поддерживали полностью обновления для
      представлений, основанных на соединениях. Это было основным вопросом,
      так как представления обычно считались необновляемыми (<quote>только для
      чтения</quote>); существовало некоторое количество ограничений, чтобы
      сделать такие представления обновляемыми.</para>

      <para>В СУБД <application>Firebird</application> также существуют
      некоторые ограничения, но эти ограничения рассматриваются только для
      <emphasis>автоматического</emphasis> обновления. Если СУБД не в состоянии
      самостоятельно произвести обновления, Вы можете создать триггеры для
      представления, чтобы реализовать необходимую логику работы.</para>
    </sect2>
  </sect1>

  <sect1 id="migration-mssql-client-access-ru">
    <title>Доступ клиентов</title>

    <para>Этот раздел описывает различия в способах доступа клиентских
    приложений к базам данных, управляемых СУБД
    <application>Firebird</application> и MS SQL.</para>

    <sect2 id="migration-mssql-client-access-builtin-ru">
      <title>Утилиты со <quote>встроенным</quote> в них доступом</title>
      <titleabbrev>Утилиты</titleabbrev>

      <para>Стандартной утилитой для работы из командной строки является
      программа <application>isql</application>. Обычно она используется для 
      выполнения больших скриптов или при написании пакетных файлов.
      <!-- TODO: provide a link to docs. --></para>

      <para>Когда имеется возможность работать с графическим интерфейсом
      пользователя (GUI), для СУБД <application>Firebird</application>
      рекомендуется использовать утилиты <application>IBOConsole</application>,
      <application>IB_SQL</application>, <application>IB Expert</application>,
      <application>DataBase Workbench</application>,
      <application>FlameRobin</application> (платформонезависимая утилита).
      БОльшая часть из указанных утилит схожа с утилитой управления для СУБД
      MS SQL <application>Enterprise Manager</application>.
      <!-- TODO: provide a link to docs. --></para>
    </sect2>

    <sect2 id="migration-mssql-client-access-developers-ru">
      <title>Клиентский доступ для разработчиков</title>
      <titleabbrev>Доступ разработчиков</titleabbrev>

      <para>Существует несколько механизмов доступа к базам данных СУБД
      <application>Firebird</application>. Среди них использование
      низкоуровневого API на языке <application>C</application>, драйвера ODBC
      (Open Database Connectivity), драйвера OLE DB (он также используется для
      доступа в технологии ActiveX Data Objects, ADO), и др.</para>

      <para>Использование низкоуровневого API на языке <application>C</application>
      позволяет создавать переносимый код. На всех платформах есть поддержка
      этого API. Это также является базисом для компонент доступа сред
      разработки <application>Delphi</application> и <application>C++
      Builder</application>, таких как InterBase Objects (IBO), FIBPlus,
      InterBase Express (IBX), UnifiedIB (UIB) и др.</para>

      <para>Использование драйвера ODBC позволяет разработчикам создавать
      код, который можно будет использовать с различными базами данных
      (и серверами баз данных) в случае, если разработчик ограничит себя
      использованием некоторого (общего) подмножества операторов языка SQL.
      Существует много утилит, использующих базы данных СУБД
      <application>Firebird</application> через драйверы ODBC.<!-- TODO: provide links to existing drivers --></para>

      <para>Использование драйвера OLE DB позволяет разработчикам использовать
      популярный интерфейс доступа к данным от Microsoft ADO API. Это дает
      возможность получать доступ к базам данных СУБД
      <application>Firebird</application> из таких сред, как
      <application>Visual Basic</application> или
      <application>ActiveX Server Pages</application> (ASP).
      В настоящее время наиболее популярной является собственная связка
      Microsoft - OLE DB-&gt;ODBC.</para>
    </sect2>
  </sect1>

  <sect1 id="migration-mssql-tools-ru">
    <title>Утилиты</title>

    <para>Этот раздел описывает утилиты, которые могут помочь в переносе
    баз данных из одной СУБД в другую, а также способные заменить стандартные
    утилиты СУБД MS SQL.</para>

    <sect2 id="migration-mssql-tools-migration-ru">
      <title>Утилиты для переноса</title>

      <para>Этот раздел описывает утилиты, которые можно использовать
      в процессе перехода с СУБД MS SQL на СУБД
      <application>Firebird</application>.</para>

      <table>
        <title>Утилиты для переноса</title>

        <tgroup cols="2" colsep="1" rowsep="1">
          <colspec colname="c1" colwidth="2*" />

          <colspec colname="c2" colwidth="1*" />

          <thead>
            <row>
              <entry align="center"><para>Название</para></entry>

              <entry align="center"><para>Кем предосталяется</para></entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry><para>Microsoft Access and Microsoft SQL Server to
              InterBase Wizard (Помощник перехода с Microsoft Access и
              Microsoft SQL Server на InterBase</para></entry>

              <entry><para><ulink
              url="http://www.ibphoenix.com/sql2gdb.html">Marcelo Lopez
              Ruiz</ulink> </para></entry>
            </row>

            <row>
              <entry><para>IBDataPump</para></entry>

              <entry><para><ulink
              url="http://www.geocities.com/poloziouk/IBDataPump.html">Alex
              Poloziouk</ulink> </para></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </sect2>

    <sect2 id="migration-mssql-tools-replacing-ru">
      <title>Замена утилит СУБД MS SQL</title>
      <titleabbrev>Замена утилит MS SQL</titleabbrev>

      <para>В следующией таблице перечислены утилиты, которые можно
      использовать в СУБД <application>Firebird</application> по аналогии
      со стандартными утилитами управления, поставляемыми с СУБД MS
      SQL.</para>

      <para>К Вашему сведению, в основном, все приложения, которые имеют
      функции, аналогичные <application>Enterprise Manager</application>,
      также способны обслуживать (выполнять) и запросы.</para>

      <table>
        <title>Альтернативные утилиты</title>

        <tgroup cols="2" colsep="1" rowsep="1">
          <colspec colname="c1" colwidth="2*" />

          <colspec colname="c2" colwidth="4*" />

          <thead>
            <row>
              <entry align="center"><para>Название</para></entry>

              <entry align="center"><para>Замена</para></entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry><para>Электронная документация</para></entry>

              <entry><para>Электронная документация PDF</para></entry>
            </row>

            <row>
              <entry><para>Утилита Client Network</para></entry>

              <entry><para>Нет необходимости; строка подключения к базе данных
              говорит сама за себя. Проверяйте правильность с помощью
              <application>isql</application> или других утилит.</para></entry>
            </row>

            <row>
              <entry><para>Enterprise Manager</para></entry>

              <entry><para>IBOConsole</para></entry>
            </row>

            <row>
              <entry><para>Enterprise Manager</para></entry>

              <entry><para><ulink
              url="http://www.ibexpert.com/">IBExpert</ulink>
              (free/commercial)</para></entry>
            </row>

            <row>
              <entry><para>Enterprise Manager</para></entry>

              <entry><para><ulink
              url="http://www.DataBaseWorkbench.com/">DataBase
              Workbench</ulink> (commercial)</para></entry>
            </row>

            <row>
              <entry><para>Import and Export Data</para></entry>

              <entry><para>-</para></entry>
            </row>

            <row>
              <entry><para>Performance Monitor</para></entry>

              <entry><para><ulink
              url="http://www.fleetriver.demon.co.uk/">InterBase
              Heartbeat</ulink> (commercial)</para></entry>
            </row>

            <row>
              <entry><para>Profiler</para></entry>

              <entry><para><ulink
              url="http://www.fleetriver.demon.co.uk/">InterBase Observer SQL
              Profiler</ulink> (commercial)</para></entry>
            </row>

            <row>
              <entry><para>Query Analyzer</para></entry>

              <entry><para>Planalyzer</para></entry>
            </row>

            <row>
              <entry><para>Утилита Server Network</para></entry>

              <entry><para>IBOConsole</para></entry>
            </row>

            <row>
              <entry><para>Service Manager</para></entry>

              <entry><para>Control Panel Applet</para></entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>Указанный список является далеко не полным, и служит для примера
      того, что и чем можно заменить. Для более полного и обновленного списка
      обратитесь к <ulink
      url="http://www.ibphoenix.com/ibp_contrib_download.html">IBPhoenix
      Contributed Downloads</ulink>.</para>
    </sect2>
  </sect1>

  <appendix id="migration-mssql-dochist-ru">
    <title>История документа</title>

    <para>Точная исторя изменения исходного файла фиксируется в модуле <filename
    class="directory">manual</filename> нашего дерева CVS; обратитесь к <ulink
    url="http://sourceforge.net/cvs/?group_id=9028">http://sourceforge.net/cvs/?group_id=9028</ulink>.</para>

    <para><revhistory>
        <revision>
          <revnumber>1.0</revnumber>

          <date>2003</date>

          <authorinitials>MLR</authorinitials>

          <revdescription>
            <para>Написан, опубликован и размещен в общем досупе автором
            Marcelo Lopez Ruiz.</para>
          </revdescription>
        </revision>

        <revision>
          <revnumber>1.1</revnumber>

          <date>1 окт 2005</date>

          <authorinitials>PV</authorinitials>

          <revdescription>
            <para>Добавлено предупреждение о вероятности устаревания
            этого документа.</para>

            <para>Раздел об управляющих конструкциях разбит на подразделы.
            Явно указано, что замена оператора <database>CASE</database>
            нужна только при использовании версий СУБД 
            <application>Firebird</application> до 1.5.</para>

            <para>Добавлена история документа. Заметки о публичном доступе
            перемещены в приложение.</para>
          </revdescription>
        </revision>

        <revision>
          <revnumber>1.1.ru</revnumber>

          <date>1 дек 2005</date>

          <authorinitials>PM</authorinitials>

          <revdescription>
            <para>Документ переведен на русский язык. Исправлены некоторые неточности.</para>
          </revdescription>
        </revision>
      </revhistory></para>
  </appendix>

  <appendix id="migration-mssql-pdnotice-ru">
    <title>Заметки о публичном доступе и отказ от претензий</title>
    <titleabbrev>Заметки о публичном доступе</titleabbrev>

    <para>Автор размещает эту статью в публичном доступе, оставляя за собой
    все авторские права. Любой вправе использовать, изменять, повторно
    публиковать, продавать, дарить эту работу без предварительного согласия
    кого бы то ни было.</para>

    <para>Эта документация предоставляется на основе <quote>как есть</quote>,
    без каких бы то ни было гарантий. Вы используете документацию на свой
    собственный риск! Ни при каких обстоятельствах ни автор(ы), ни
    распространитель(ли) не будут нести ответственность за возможные
    повреждения, появившиеся из-за использования или невозможности
    использования этой документации.</para>
  </appendix>
</article>