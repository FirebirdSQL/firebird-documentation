<?xml version="1.0" encoding="UTF-8"?>
<!--
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
-->
<article id="nbackup-nl" lang="nl">
  <articleinfo>
    <title>Firebirds nbackup tool</title>

    <author>
      <firstname>Paul</firstname>

      <surname>Vinkenoog</surname>
    </author>

    <edition>21 oktober 2005 - Documentversie 0.1 - voor Firebird 2.0
    bèta</edition>
  </articleinfo>

  <section id="nbackup-nl-intro">
    <title>Inleiding</title>

    <para><firstterm>nbackup</firstterm> is een nieuwe backuptool die
    meegeleverd wordt bij Firebird 2.0. Het biedt mogelijkheden die het al
    langer bestaande <firstterm>gbak</firstterm> niet heeft, maar is geen
    vervanging voor deze oudere tool. Beide programmes hebben hun krachten en
    zwakheden; vooralsnog zullen ze naast elkaar blijven bestaan.</para>
  </section>

  <section id="nbackup-nl-overzicht">
    <title>Kenmerken van nbackup - een overzicht</title>

    <para>Met nbackup kunnen twee verschillende soorten taken worden
    uitgevoerd:</para>

    <orderedlist>
      <listitem>
        <para>Het maken en terugzetten van zowel volledige als aanvullende
        backups. Een aanvullende backup (Engelse term: <firstterm>incremental
        backup</firstterm>) bevat alleen de wijzigingen sinds een bepaalde
        voorgaande backup.</para>
      </listitem>

      <listitem>
        <para>Het vergrendelen van het databasebestand zodat het vervolgens
        met kopieer- of backuptools naar keuze kan worden gebackupt. In deze
        modus maakt nbackup dus géén backup; het zorgt alleen dat je er zelf
        één kunt maken zonder risico op corruptie van de database. Ook hierbij
        is er een voorziening voor terugzetten.</para>
      </listitem>
    </orderedlist>

    <para>Beide modi kunnen op een aktieve database worden toegepast, zonder
    hinder voor verbonden gebruikers. De gemaakte backup komt steeds overeen
    met de toestand van de database <emphasis>aan het begin van de
    operatie</emphasis>. Op deze punten is er dus geen verschil met
    gbak.</para>

    <section id="nbackup-nl-voordelen">
      <title>Voordelen van nbackup</title>

      <itemizedlist>
        <listitem>
          <para><emphasis>Beide modi:</emphasis> een hoge snelheid (zo hoog
          als hardware en besturingssysteem toelaten), want nbackup kijkt niet
          naar de data zelf. In de backupmodus worden de gegevens min of meer
          blindelings naar het backupbestand geschreven.</para>
        </listitem>

        <listitem>
          <para><emphasis>Backup/restoremodus:</emphasis> tijd- en
          ruimtewinst, want er is niet elke keer een volledige backup nodig.
          Dit kan enorm schelen bij omvangrijke databases.</para>
        </listitem>

        <listitem>
          <para><emphasis>Vergrendel/ontgrendelmodus:</emphasis> volledige
          vrijheid in de keuze van de backup-, kopieer- en/of
          compressietools.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="nbackup-nl-beperkingen">
      <title>Beperkingen van nbackup</title>

      <itemizedlist>
        <listitem>
          <para>nbackup zorgt niet voor het opschonen en inkrimpen van de
          database zoals gbak dat doet.</para>
        </listitem>

        <listitem>
          <para>Met een nbackup backup/restorecyclus kun je niet de eigenaar
          van de database veranderen, zoals met gbak.</para>
        </listitem>

        <listitem>
          <para>nbackup kan geen <firstterm>transporteerbare
          backups</firstterm> maken, d.w.z. backups die je kunt restoren op
          een ander platform of serverversie.</para>
        </listitem>

        <listitem>
          <para>nbackup is vooralsnog alleen bruikbaar voor databases die uit
          een enkel bestand bestaan.</para>
        </listitem>

        <listitem>
          <para>Met nbackup kun je alleen lokale databases backuppen.</para>
        </listitem>
      </itemizedlist>

      <para>In de volgende secties zullen de diverse functies van nbackup
      uitgebreid worden besproken.</para>
    </section>
  </section>

  <section id="nbackup-nl-backups">
    <title>Backups maken en terugzetten</title>

    <!--UITZOEKEN: /opt/firebird nog steeds standaardplek voor Firebird 2.0? Zo niet, aanpassen op TWEE plaatsen
           in zowel Ned. als Eng. versie.-->

    <para>Vooraf: <filename>nbackup.exe</filename> bevindt zich in de
    <filename class="directory">bin</filename> subdirectory van je
    Firebird-map. Typische lokaties zijn bijvoorbeeld <filename
    class="directory">C:\Program Files\Firebird\Firebird_2_0\bin</filename>
    (Windows) of <filename class="directory">/opt/firebird/bin</filename>
    (Linux). Net als de meeste meegeleverde tools heeft nbackup geen grafische
    interface; je start het vanaf de opdrachtregel (of vanuit een batchbestand
    of programma).</para>

    <section id="nbackup-nl-backups-voll">
      <title>Volledige backups</title>

      <section>
        <title>Een volledige backup maken</title>

        <para>Om een volledige backup te maken luidt de opdracht:</para>

        <blockquote>
          <programlisting>nbackup [-U <replaceable>&lt;gebruiker&gt;</replaceable> -P <replaceable>&lt;wachtw&gt;</replaceable>] -B 0 <replaceable>&lt;database&gt;</replaceable> [<replaceable>&lt;backupbestand&gt;</replaceable>]</programlisting>
        </blockquote>

        <para>Voorbeeld:</para>

        <blockquote>
          <screen>C:\Databases&gt; nbackup -B 0 inventaris.fdb inventaris_1-mrt-2006.nbk</screen>
        </blockquote>

        <para id="nbackup-nl-backups-opm">Opmerkingen:</para>

        <itemizedlist>
          <listitem>
            <para>De parameter <parameter>-B</parameter> staat voor backup
            (goh!). Het <firstterm>backupniveau</firstterm> 0 betekent dat er
            een volledige backup wordt gemaakt. Backupniveaus hoger dan 0
            worden gebruikt voor aanvullende backups; deze worden verderop
            besproken.</para>
          </listitem>

          <listitem>
            <para>In plaats van een databasebestandsnaam mag ook een alias
            worden opgegeven.</para>
          </listitem>

          <listitem>
            <para>In plaats van een backupbestandsnaam mag ook
            <systemitem>stdout</systemitem> worden opgegeven. De backup wordt
            dan naar de standaarduitvoer gestuurd en kan van daaraf verder
            worden geleid naar bijvoorbeeld een bandarchief of een
            compressieprogramma.</para>
          </listitem>

          <listitem>
            <para>De parameters <parameter>-U</parameter> (user) en
            <parameter>-P</parameter> (password) kunnen worden
            weggelaten:</para>

            <itemizedlist spacing="compact">
              <listitem>
                <para>als je als superuser (<systemitem
                class="username">root</systemitem>, <systemitem
                class="username">Administrator</systemitem>...) bent ingelogd,
                of</para>
              </listitem>

              <listitem>
                <para>als de omgevingsvariabelen <envar>ISC_USER</envar> en
                <envar>ISC_PASSWORD</envar> zijn ingesteld.</para>
              </listitem>
            </itemizedlist>

            <para>Voor de overzichtelijkheid laten we deze twee parameters in
            de voorbeelden telkens weg.</para>
          </listitem>

          <listitem>
            <para>De verschillende parameters (<parameter>-B</parameter>,
            <parameter>-U</parameter> en <parameter>-P</parameter>) mogen in
            elke gewenste volgorde voorkomen. Wel moet elke parameter direct
            worden gevolgd door zijn eigen bijbehorende argument(en). Voor
            <parameter>-B</parameter> zijn dat er drie: niveaugetal, database
            en backupbestand - in die volgorde!</para>
          </listitem>

          <listitem>
            <para>Als de <parameter>-B</parameter> parameter als laatste komt,
            <emphasis>mag</emphasis> de naam van het backupbestand worden
            weggelaten. nbackup stelt dan zelf een naam samen, gebaseerd op de
            naam van de database, het backupniveau, de datum en de tijd. Dit
            kan overigens tot een botsing leiden (en tot een mislukte backup)
            als twee backupopdrachten van hetzelfde niveau in dezelfde minuut
            worden gegeven.</para>
          </listitem>
        </itemizedlist>

        <warning>
          <para>Gebruik nbackup <emphasis>niet</emphasis> voor databases die
          uit meerdere bestanden bestaan. Dit kan leiden tot corruptie en
          gegevensverlies, ondanks dat nbackup niet zal protesteren tegen een
          dergelijke opdracht.</para>
        </warning>

        <section id="nbackup-nl-backups-werking">
          <title>Iets over de werking</title>

          <para>NB: Wat onder dit kopje volgt is géén noodzakelijke kennis
          voor het gebruik van nbackup. Het geeft alleen een globaal (en
          onvolledig) beeld van wat er onder de motorkap gebeurt tijdens de
          uitvoering van nbackup <parameter>-B</parameter>:</para>

          <procedure>
            <step>
              <para>Om te beginnen wordt het databasebestand vergrendeld door
              het wijzigen van een interne toestandsvlag. Vanaf dit moment
              worden alle wijzigingen in de database weggeschreven naar een
              tijdelijk bestand - het verschilbestand oftewel
              <firstterm>deltabestand</firstterm>.</para>
            </step>

            <step>
              <para>Daana wordt de feitelijke backup gemaakt. Dit is geen
              eenvoudige bestandskopie; terugzetten moet dus ook weer met
              nbackup gebeuren.</para>
            </step>

            <step>
              <para>Nadat de backup gemaakt is, wordt de inhoud van het
              deltabestand geïntegreerd met het hoofdbestand. Vervolgens wordt
              het hoofdbestand ontgrendeld (vlag gaat weer op
              <quote>normaal</quote>) en de delta verwijderd.</para>
            </step>
          </procedure>

          <para>De functionaliteit van de stappen 1 en 3 wordt verzorgd door
          twee nieuwe SQL-opdrachten: <database>ALTER DATABASE BEGIN
          BACKUP</database> en <database>ALTER DATABASE END BACKUP</database>.
          In tegenstelling tot hetgeen de namen suggereren, zorgen deze
          opdrachten <emphasis>niet</emphasis> voor het maken van de backup
          zelf; ze scheppen alleen de noodzakelijke voorwaarden waaronder het
          hoofdbestand veilig kan worden gebackupt. En voor alle
          duidelijkheid: je hoeft deze SQL-opdrachten niet zelf te geven;
          nbackup zorgt hiervoor, op de juiste momenten.</para>
        </section>
      </section>

      <section>
        <title>Een volledige backup terugzetten</title>

        <para>Een volledige backup wordt als volgt teruggezet:</para>

        <blockquote>
          <programlisting>nbackup [-U <replaceable>&lt;gebruiker&gt;</replaceable> -P <replaceable>&lt;wachtw&gt;</replaceable>] -R <replaceable>&lt;database&gt;</replaceable> [<replaceable>&lt;backupbestand&gt;</replaceable>]</programlisting>
        </blockquote>

        <para>Voorbeeld:</para>

        <blockquote>
          <screen>C:\Databases&gt; nbackup -R inventaris.fdb inventaris_1-mrt-2006.nbk</screen>
        </blockquote>

        <para id="nbackup-nl-terugzetten-opm">Opmerkingen:</para>

        <itemizedlist>
          <listitem>
            <para>Bij het terugzetten wordt geen niveau aangegeven.</para>
          </listitem>

          <listitem>
            <para>Bij het terugzetten <emphasis>moet</emphasis> de parameter
            <parameter>-R</parameter> (restore) de laatste zijn; dit om
            redenen die later duidelijk zullen worden.</para>
          </listitem>

          <listitem>
            <para>Als de opgegeven database al bestaat en er is niemand mee
            verbonden, dan zal zij zonder enige waarschuwing worden
            overschreven! Zijn er wel gebruikers verbonden, dan mislukt het
            terugzetten en krijg je een foutmelding.</para>
          </listitem>

          <listitem>
            <para>Ook bij het terugzetten mag de naam van het backupbestand
            worden weggelaten. Nbackup vraagt je dan om de naam alsnog op te
            geven. <emphasis>Op dit moment (Firebird 2.0 alpha 3) leidt dit
            echter - in elk geval onder Windows - tot een fout bij het
            terugzetten.</emphasis></para>
          </listitem>
        </itemizedlist>
      </section>
    </section>

    <section id="nbackup-nl-backups-aanv">
      <title>Aanvullende backups</title>

      <section>
        <title>Aanvullende backups maken</title>

        <para>Om een aanvullende backup te maken geven we een niveau hoger dan
        0 aan. Een aanvullende backup van niveau <replaceable>N</replaceable>
        bevat telkens de wijzigingen in de database sinds de meest recente
        backup van niveau <replaceable>N-1</replaceable>.</para>

        <para>Voorbeelden:</para>

        <para>Een dag na het maken van de volledige backup (met niveau 0) maak
        je er een met niveau 1:</para>

        <blockquote>
          <screen>C:\Databases&gt; nbackup -B 1 inventaris.fdb inventaris_2-mrt-2006.nbk</screen>
        </blockquote>

        <para>Deze backup bevat dus alleen de wijzigingen van de laatste
        dag.</para>

        <para>Weer een dag later maak je er nog eentje van niveau 1:</para>

        <blockquote>
          <screen>C:\Databases&gt; nbackup -B 1 inventaris.fdb inventaris_3-mrt-2006.nbk</screen>
        </blockquote>

        <para>Deze backup bevat de wijzigingen van de laatste
        <emphasis>twee</emphasis> dagen, sinds de volledige backup, dus niet
        alleen die sinds de vorige niveau-1-backup.</para>

        <para>Een paar uur later maken we een backup van niveau 2:</para>

        <blockquote>
          <screen>C:\Databases&gt; nbackup -B 2 inventaris.fdb inventaris_3-mrt-2006_2.nbk</screen>
        </blockquote>

        <para>Deze jongste backup bevat alleen de wijzigingen sinds de meest
        recente niveau-1-backup, dus die van de laatste paar uren.</para>

        <note>
          <para>Alle <link linkend="nbackup-nl-backups-opm">opmerkingen</link>
          die gemaakt zijn bij het maken van volledige backups, gelden ook
          voor aanvullende backups.</para>
        </note>

        <warning>
          <para>Nogmaals: gebruik nbackup niet voor databases die uit meerdere
          bestanden bestaan.</para>
        </warning>
      </section>

      <section>
        <title>Aanvullende backups terugzetten</title>

        <para>Bij het terugzetten van aanvullende backups moet de hele reeks
        backupbestanden worden gespecificeerd vanaf niveau 0 tot en met het
        gewenste niveau. Er wordt dan ook altijd een database vanaf de grond
        opgebouwd, in stapjes (dit stapsgewijs aanvullen tot een herstelde
        database verklaart de Engelse term <foreignphrase>incremental
        backup</foreignphrase>).</para>

        <para>De formele syntax luidt:</para>

        <blockquote>
          <programlisting>nbackup [-U <replaceable>&lt;gebruiker&gt;</replaceable> -P <replaceable>&lt;wachtwoord&gt;</replaceable>] 
        -R <replaceable>&lt;database&gt;</replaceable> [<replaceable>&lt;backup0&gt;</replaceable> [<replaceable>&lt;backup1&gt;</replaceable> [<replaceable>...</replaceable>] ] ]       </programlisting>
        </blockquote>

        <para>Het terugzetten van de niveau-2-backup uit het voorgaande
        voorbeeld gaat dus als volgt:</para>

        <blockquote>
          <screen>C:\Databases&gt; nbackup -R inventaris.fdb inventaris_1-mrt-2006.nbk
                inventaris_3-mrt-2006.nbk inventaris_3-mrt-2006_2.nbk</screen>
        </blockquote>

        <para>Uiteraard is de regel hier alleen gesplitst voor de
        overzichtelijkheid - in de praktijk typ je alles achter elkaar en
        drukt dan pas op <keycap>Enter</keycap>.</para>

        <para>Opmerkingen (in aanvulling op de <link
        linkend="nbackup-nl-terugzetten-opm">opmerkingen bij het terugzetten
        van een volledige backup</link>):</para>

        <itemizedlist>
          <listitem>
            <para>Omdat bij de <parameter>-R</parameter> optie niet van
            tevoren bekend is hoeveel bestandsnamen er zullen volgen (bij
            terugzetten geven we immers geen niveaugetal op), gaat nbackup
            ervan uit dat alle argumenten na de <parameter>-R</parameter>
            namen van backupbestanden zijn. Het is hierom dat er na de lijst
            met bestandsnamen geen andere parameter (<parameter>-U</parameter>
            of <parameter>-P</parameter>) meer mag volgen.</para>
          </listitem>

          <listitem>
            <para>Er is geen formele limiet aan het aantal backupniveaus, maar
            verder gaan dan niveau 3 of 4 zal in de praktijk zelden nuttig
            zijn.</para>
          </listitem>
        </itemizedlist>

        <section>
          <title>Niet-passende schakels</title>

          <para>Wat gebeurt er als je per ongeluk een bestand weglaat, of een
          reeks bestanden opgeeft die niet allemaal bij elkaar passen? Je zou
          je voor kunnen stellen dat je in het bovenstaande voorbeeld bij
          vergissing <filename>inventaris_2-mrt-2006.nbk</filename> opgeeft in
          plaats van <filename>inventaris_3-mrt-2006.nbk</filename>. Beide
          zijn backupbestanden van niveau 1; in beide gevallen krijgen we dus
          een keurige niveaureeks 0, 1, 2. Maar het niveau-2-bestand is
          aanvullend ten opzichte van de niveau-1-backup van 3 maart, niet
          t.o.v. die van 2 maart.</para>

          <para>Gelukkig kan een dergelijke vergissing nooit tot een foutief
          teruggezette database leiden. Elk backupbestand bevat namelijk een
          unieke ID. Voorts is in elke backup van niveau 1 of hoger de ID
          opgeslagen van de backup waarop hij gebaseerd is. Bij het
          terugzetten controleert nbackup deze gegevens; als er ergens in de
          keten iets niet klopt, wordt de operatie geannuleerd en krijg je een
          foutmelding.</para>
        </section>
      </section>
    </section>

    <section id="nbackup-nl-backups-prakt">
      <title>Toepassing in de praktijk</title>

      <para>Een backupschema met gebruik van nbackup zou er als volgt uit
      kunnen zien:</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para>Elke maand een volledige backup (niveau 0);</para>
        </listitem>

        <listitem>
          <para>Elke week een niveau 1;</para>
        </listitem>

        <listitem>
          <para>Dagelijks een niveau 2;</para>
        </listitem>

        <listitem>
          <para>Elk uur een niveau 3.</para>
        </listitem>
      </itemizedlist>

      <para>Zolang alle backups bewaard worden, kun je nu de database
      herstellen tot de toestand van elk gewenst uur in het verleden. Hierbij
      worden voor elke herstelaktie maximaal vier backupbestanden gebruikt.
      Natuurlijk regel je e.e.a. zó dat de grotere, tijdrovende backups op
      rustige uren gepland worden. In dit geval zouden de backups van de
      niveaus 0 en 1 in de weekeinden gemaakt kunnen worden, en die van niveau
      2 's nachts.</para>

      <para>Wil je niet alles voor de eeuwigheid bewaren, dan kun je er een
      wisschema aan koppelen:</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para>Niveau-3-backups worden gewist als ze ouder zijn dan acht
          dagen;</para>
        </listitem>

        <listitem>
          <para>Niveau 2 na een maand;</para>
        </listitem>

        <listitem>
          <para>Niveau 1 na zes maanden;</para>
        </listitem>

        <listitem>
          <para>Niveau 0 na twee jaar, behalve bijvoorbeeld de eerste van elk
          jaar.</para>
        </listitem>
      </itemizedlist>

      <para>Dit is uiteraard maar een voorbeeld; het hangt van de toepassing,
      de databasegrootte, de aktiviteit enz. af wat in een bepaald geval
      nuttig is.</para>
    </section>

    <section id="nbackup-nl-backups-verder">
      <title>Verder lezen?</title>

      <para>Je weet nu alles wat nodig is om met nbackup volledige en/of
      aanvullende backups te maken en terug te zetten. Je hoeft alleen verder
      te lezen als je backuptools naar keuze wilt gebruiken voor je
      Firebird-databases.</para>

      <para>Als je dat niet nodig vindt: veel sukses gewenst met het werken
      met nbackup!</para>
    </section>
  </section>

  <section id="nbackup-nl-vergr-ontgr">
    <title>Vergrendelen en ontgrendelen</title>

    <para>Wil je liever met je eigen backupgereedschap een veiligheidskopie
    maken, of gewoon een bestandskopie maken, dan komt modus 2, de
    ver/ontgrendeltaak, in beeld. <quote>Vergrendelen</quote> houdt hier in
    dat het hoofdbestand van de database tijdelijk wordt bevroren,
    <emphasis>niet</emphasis> dat er geen wijzigingen in de database mogen
    plaatsvinden. Net als bij modus 1 worden wijzigingen naar een tijdelijk
    bestand geschreven en na ontgrendelen alsnog opgenomen in het
    hoofdbestand.</para>

    <para>Ter herinnering: <filename>nbackup.exe</filename> bevindt zich in de
    <filename class="directory">bin</filename> subdirectory van je
    Firebird-map. Typische lokaties zijn bijvoorbeeld <filename
    class="directory">C:\Program Files\Firebird\Firebird_2_0\bin</filename>
    (Windows) of <filename class="directory">/opt/firebird/bin</filename>
    (Linux). Er is geen grafische interface; je start het vanaf de
    opdrachtregel (of vanuit een batchbestand of programma).</para>

    <section id="nbackup-nl-vergr-backup">
      <title>Database vergrendelen en zelf backuppen</title>

      <para>Een typische sessie waarbij je zelf de backup maakt, verloopt als
      volgt.</para>

      <procedure>
        <step>
          <para>Vergrendel de database met de <parameter>-L</parameter> (lock)
          optie:</para>

          <blockquote>
            <para><programlisting>nbackup [-U <replaceable>&lt;gebruiker&gt;</replaceable> -P <replaceable>&lt;wachtwoord&gt;</replaceable>] -L <replaceable>&lt;database&gt;</replaceable></programlisting></para>
          </blockquote>
        </step>

        <step>
          <para>Kopieer/backup/zip het databasebestand nu naar hartelust met
          gereedschap van je eigen keuze. Een simpele bestandskopie is hier
          ook mogelijk.</para>
        </step>

        <step>
          <para>Ontgrendel de database met <parameter>-N</parameter>
          (uNlock):</para>

          <blockquote>
            <para><programlisting>nbackup [-U <replaceable>&lt;gebruiker&gt;</replaceable> -P <replaceable>&lt;wachtwoord&gt;</replaceable>] -N <replaceable>&lt;database&gt;</replaceable></programlisting></para>
          </blockquote>
        </step>
      </procedure>

      <para>Door de laatste opdracht worden ook eventuele wijzigingen - die
      naar een tijdelijk bestand zijn weggeschreven - weer in het hoofdbestand
      verwerkt.</para>

      <para>De gemaakte backup/kopie bevat de gegevens zoals die op het moment
      van vergrendelen in de database aanwezig waren, ongeacht hoe lang de
      vergrendeling heeft geduurd, en ongeacht hoelang je hebt gewacht met het
      maken van de feitelijke backup.</para>

      <warning>
        <para>Ook voor de ver- en ontgrendelfuncties van nbackup geldt dat ze
        niet gebruikt moeten worden op databases die uit meerdere bestanden
        bestaan. Zolang er op dit punt niets veranderd is, moet nbackup op
        geen enkele wijze op dit soort databases worden losgelaten!</para>
      </warning>
    </section>

    <section id="nbackup-nl-terugz-fixup">
      <title>Terugzetten van een na <quote>nbackup -L</quote> gemaakte
      backup</title>

      <para>Een kopie van een vergrendelde database is natuurlijk zelf ook een
      vergrendelde database, en daarom niet meteen klaar voor normaal gebruik.
      Mocht je oorspronkelijke database verloren gaan of beschadigd raken, en
      de zelfgemaakte kopie moet worden teruggezet (of mocht je de kopie op
      een andere computer willen installeren), ga dan als volgt te
      werk:</para>

      <procedure>
        <step>
          <para>Kopieer/herstel/ontzip zelf de database-backup met de daarvoor
          nodige tools.</para>
        </step>

        <step>
          <para>Ontgrendel vervolgens de teruggezette database
          <emphasis>niet</emphasis> met de <parameter>-N</parameter> optie,
          maar met <parameter>-F</parameter> (fixup):</para>

          <blockquote>
            <para><programlisting>nbackup -F <replaceable>&lt;database&gt;</replaceable></programlisting></para>
          </blockquote>
        </step>
      </procedure>

      <para>Waarom zijn er twee ontgrendelopties, <parameter>-N</parameter> en
      <parameter>-F</parameter>?</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para><parameter>-N</parameter> zorgt er eerst voor dat eventuele
          wijzigingen, gemaakt sinds het vergrendelen door
          <parameter>-L</parameter>, worden verwerkt in het hoofdbestand van
          de database. Vervolgens wordt de database weer volledig vrijgegeven
          voor lezen en schrijven, en het tijdelijke bestand wordt
          gewist.</para>
        </listitem>

        <listitem>
          <para><parameter>-F</parameter> zet alleen maar de statusvlag van de
          zelf teruggezette database weer op <quote>normaal</quote>.</para>
        </listitem>
      </itemizedlist>

      <para>Je gebruikt dus:</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para><parameter>-N</parameter> na het zelf
          <emphasis>maken</emphasis> van een kopie/backup (om de eerder
          gegeven <parameter>-L</parameter> weer ongedaan te maken);</para>
        </listitem>

        <listitem>
          <para><parameter>-F</parameter> na het zelf
          <emphasis>terugzetten</emphasis> van een dergelijke backup.</para>
        </listitem>
      </itemizedlist>

      <note>
        <para>Het is een beetje ongelukkig dat de laatse optie
        <parameter>-F</parameter> (van Fixup) is genoemd. Er wordt immers
        niets gerepareerd; de database wordt alleen
        <emphasis>ontgrendeld</emphasis>. De optie <parameter>-N</parameter>
        (uNlock, ontgrendel) daarentegen voert niet alleen een ontgrendeling
        uit, maar maakt ook de database weer in orde
        (<emphasis>fikst</emphasis> de database) door de tussentijdse mutaties
        te integreren. Maar hier zullen we mee moeten leven.</para>
      </note>
    </section>

    <section id="nbackup-nl-vergr-extra">
      <title>Onder de motorkap</title>

      <para>NB: Deze paragraaf bevat geen noodzakelijke kennis, maar wat extra
      informatie die je inzicht in de verschillende schakelopties kan
      verdiepen.</para>

      <!--Deze twee orderedlists moeten eigenlijk procedures zijn, maar ik wil compacte spatiëring!-->

      <para><command>nbackup <parameter>-L</parameter></command> doet het
      volgende:</para>

      <orderedlist spacing="compact">
        <listitem>
          <para>Verbinden met de database;</para>
        </listitem>

        <listitem>
          <para>Transactie starten;</para>
        </listitem>

        <listitem>
          <para>ALTER DATABASE BEGIN BACKUP aanroepen (de werking hiervan is
          besproken in de <link
          linkend="nbackup-nl-backups-werking">extra-informatie bij nbackup
          -B</link>);</para>
        </listitem>

        <listitem>
          <para>Transactie vastleggen d.m.v.
          <database>COMMIT</database>;</para>
        </listitem>

        <listitem>
          <para>Verbinding met database verbreken.</para>
        </listitem>
      </orderedlist>

      <para><command>nbackup <parameter>-N</parameter></command> neemt
      dezelfde stappen, maar uiteraard met <quote><database>...END
      BACKUP</database></quote> in stap 3.</para>

      <para><command>nbackup <parameter>-F</parameter></command> werkt als
      volgt:</para>

      <orderedlist spacing="compact">
        <listitem>
          <para>Het teruggezette databasebestand wordt geopend;</para>
        </listitem>

        <listitem>
          <para>In het bestand wordt de toestandsvlag gewijzigd van
          vergrendeld (<constant>nbak_state_stalled</constant>) in normaal
          (<constant>nbak_state_normal</constant>);</para>
        </listitem>

        <listitem>
          <para>Het bestand wordt weer gesloten.</para>
        </listitem>
      </orderedlist>

      <note>
        <para>nbackup -F werkt puur op bestandsniveau en kan dus zelfs worden
        uitgevoerd zonder dat er een Firebird-server draait. Eventuele bij de
        aanroep meegegeven <parameter>-U</parameter> of
        <parameter>-P</parameter> parameters worden dan ook compleet
        genegeerd.</para>
      </note>
    </section>
  </section>

  <appendix id="nbackup-nl-dochist">
    <title>Documenthistorie</title>

    <para>De exacte geschiedenis van dit document is (of zal zijn) na te gaan
    in de module <filename class="directory">manual</filename> in het Firebird
    CVS-archief; zie <ulink
    url="http://sourceforge.net/cvs/?group_id=9028">http://sourceforge.net/cvs/?group_id=9028</ulink></para>

    <para><revhistory>
        <revision>
          <revnumber>0.1</revnumber>

          <date>21 oktober 2005</date>

          <authorinitials>PV</authorinitials>

          <revdescription>
            <para>Eerste editie.</para>
          </revdescription>
        </revision>
      </revhistory></para>
  </appendix>

  <appendix id="nbackup-licentie">
    <title>Licentie</title>

    <para>De inhoud van deze Documentatie valt onder de <citetitle>Public
    Documentation License, Version 1.0</citetitle> (hierna te noemen de
    <quote>Licentie</quote>); gebruik van deze Documentatie is alleen
    toegestaan als voldaan wordt aan de voorwaarden van de Licentie.
    Exemplaren van de Licentie zijn verkrijgbaar op <ulink
    url="http://www.firebirdsql.org/pdfmanual/pdl.pdf">http://www.firebirdsql.org/pdfmanual/pdl.pdf</ulink>
    (PDF) en <ulink
    url="http://www.firebirdsql.org/manual/pdl.html">http://www.firebirdsql.org/manual/pdl.html</ulink>
    (HTML).</para>

    <para>De Oorspronkelijke Documentatie is getiteld <citetitle>Firebirds
    nbackup tool</citetitle>.</para>

    <para>De Oorspronkelijke Schrijver van de Oorspronkelijke Documentatie is:
    Paul Vinkenoog.</para>

    <para>Copyright (C) 2005. Alle rechten voorbehouden. Contactadres
    Oorspronkelijke Schrijver: paulvink at users dot sourceforge dot
    net.</para>
  </appendix>
</article>